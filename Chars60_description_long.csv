Num,Acronym,Description,Author,Pub Year,Category,Main Formula,Other Formula,CRSP,Compustat(annual),Compustat(quarterly),IBES,description
A.1.2,Abr1,"cumulative abnormal returns around earnings announcement dates, 1-month holding period","Chan, Jegadeesh, and Lakonishok",1996,Momentum,,,,,,,p63
A.1.2,Abr12,"cumulative abnormal returns around earnings announcement dates, 6-month holding period","Chan, Jegadeesh, and Lakonishok",1996,Momentum,,,,,,,
A.1.2,Abr6,"cumulative abnormal returns around earnings announcement dates, 12-month holding period","Chan, Jegadeesh, and Lakonishok",1996,Momentum,,,,,,,
A.2.1,Bm,Book-to-market equity,"Rosenberg, Reid, and Lanstein ",1985,Value-versus-growth,data_rawq['bm'] = data_rawq['beq']/data_rawq['me'],"data_rawq['beq'] = np.where(data_rawq['seqq']>0, data_rawq['seqq']+data_rawq['txditcq']-data_rawq['pstkq'], np.nan)
data_rawq['beq'] = np.where(data_rawq['beq']<=0, np.nan, data_rawq['beq'])
* 'me' from rawq",1,0,1,0,"At the end of June of each year t, we split stocks into deciles based on Bm, which is the book equity for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Bm. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1. Following Davis, Fama, and French (2000), we measure book equity as stockholders' book equity, plus balance sheet deferred taxes and investment tax credit (Compustat annual item TXDITC) if available, minus the book value of preferred stock. Stockholders' equity is the value reported by Compustat (item SEQ), if it is available. If not, we measure stockholders' equity as the book value of common equity (item CEQ) plus the par value of preferred stock (item PSTK), or the book value of assets (item AT) minus total liabilities (item LT). Depending on availability, we use redemption (item PSTKRV), liquidating (item PSTKL), or par value (item PSTK) for the book value of preferred stock."
A.2.10,"Ep q 1, Ep q 6, and Ep q 12","Q Quarterly Earnings-to-price(1-month holding period), uarterly Earnings-to-price(6-month holding period), Quarterly Earnings-to-price(12-month holding period), ",Basu,1983,Value-versus-growth,,,,,,,"At the beginning of each month t, we split stocks into deciles based on quarterly earnings-to-price, Epq, which is income before extraordinary items (Compustat quarterly item IBQ) divided by the market equity (from CRSP) at the end of month t - 1. Before 1972, we use quarterly earnings from fiscal quarters ending at least four months prior to the portfolio formation. Starting from 1972, we use quarterly earnings from the most recent quarterly earnings announcement dates (item RDQ). For a firm to enter the portfolio formation, we require the end of the fiscal quarter that corresponds to its most recent quarterly earnings to be within six months prior to the portfolio formation. This restriction is imposed to exclude stale earnings information. To avoid potentially erroneous records, we also require the earnings announcement date to be after the corresponding fiscal quarter end. Firms with non-positive earnings are excluded. For firms with more than one share class, we merge the market equity for all share classes before computing Epq. We calculate decile returns for the current month t (Epq1), from month t to t + 5 (Epq6), and from month t to t + 11 (Epq12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in, for instance, Epq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Epq6 decile."
A.2.12,Cp,Cash ﬂow-to-price,"Lakonishok, Shleifer, and Vishny ",1994,Value-versus-growth,data_rawa['cp'] = data_rawa['cf'] / data_rawa['me'],"data_rawa['cf'] = data_rawa['ib'] + data_rawa['dp']
* 'me' from rawa
",1,1,0,0,"At the end of June of each year t, we split stocks into deciles based on cash flow-to-price, Cf, which is cash flows for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1. Cash flows are income before extraordinary items (Com- pustat annual item IB) plus depreciation (item DP)). For firms with more than one share class, we merge the market equity for all share classes before computing Cp. Firms with non-positive cash flows are excluded. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.2.13,"Cpq1, Cpq6, Cpq12","Quarterly Cash Flow-to-price (1-month holding period), Quarterly Cash Flow-to-price (6-month holding period), Quarterly Cash Flow-to-price (12-month holding period)","Lakonishok, Shleifer, and Vishny",1994,Value-versus-growth,,,,,,,"At the beginning of each month t, we split stocks into deciles based on quarterly cash flow-to-price,
Cpq, which is cash flows for the latest fiscal quarter ending at least four months ago divided by the market equity (from CRSP) at the end of month t - 1. Quarterly cash flows are income before extraordinary items (Compustat quarterly item IBQ) plus depreciation (item DPQ). For firms with more than one share class, we merge the market equity for all share classes before computing Cpq. Firms with non-positive cash flows are excluded. We calculate decile returns for the current month t (Epq1), from month t to t + 5 (Epq6), and from month t to t + 11 (Epq12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in, for instance, Epq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Epq6 decile."
A.2.14,Dp(dy),Dividend yield,Litzenberger and Ramaswamy,1979,Value-versus-growth,"crsp_mom['dy'] = ttm12(series='mdivpay', df=crsp_mom)/crsp_mom['me']","crsp_mom['permno'] = crsp_mom['permno'].astype(int)
crsp_mom['ret'] = crsp_mom['ret'].fillna(0)
crsp_mom['me'] = crsp_mom['prc'].abs() * crsp_mom['shrout']  # calculate market equity
crsp_mom['retx'] = np.where(crsp_mom['me'].isnull(), 0, crsp_mom['retx'])
# dy
crsp_mom['me_l1'] = crsp_mom.groupby(['permno'])['me'].shift(1)
crsp_mom['retdy'] = crsp_mom['ret'] - crsp_mom['retx']
crsp_mom['mdivpay'] = crsp_mom['retdy']*crsp_mom['me_l1']
",1,0,0,0,"At the end of June of each year t, we sort stocks into deciles based on dividend yield, Dp, which is the total dividends paid out from July of year t - 1 to June of t divided by the market equity (from CRSP) at the end of June of t. We calculate monthly dividends as the begin-of-month market equity times the difference between returns with and without dividends. Monthly dividends are then accumulated from July of t - 1 to June of t. We exclude firms that do not pay dividends. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.2.16,Op and Nop, (Net) Payout Yield,"Richardson, and Roberts",2007,Value-versus-growth,"data_rawq['op'] = (ttm4('revtq', data_rawq)-ttm4('cogsq', data_rawq)-ttm4('xsgaq0', data_rawq)-ttm4('xintq0', data_rawq))/data_rawq['beq_l4']
data_rawa['nop'] = np.where(data_rawa['nop']<=0, np.nan, data_rawa['nop'] )","# op
data_rawq['xintq0'] = np.where(data_rawq['xintq'].isnull(), 0, data_rawq['xintq'])
data_rawq['xsgaq0'] = np.where(data_rawq['xsgaq'].isnull(), 0, data_rawq['xsgaq'])
data_rawq['beq'] = np.where(data_rawq['seqq']>0, data_rawq['seqq']+data_rawq['txditcq']-data_rawq['pstkq'], np.nan)
data_rawq['beq'] = np.where(data_rawq['beq']<=0, np.nan, data_rawq['beq'])
data_rawq['beq_l4'] = data_rawq.groupby(['permno'])['beq'].shift(4)

#nop
data_rawa['net_p'] = data_rawa['dvc'] + data_rawa['prstkc'] + 2*data_rawa['pstkrv'] - data_rawa['sstk']
* 'me' from rawa
data_rawa['nop'] = data_rawa['net_p'] / data_rawa['me']
",1,1,1,0,"Per Boudoukh, Michaely, Richardson, and Roberts (2007), total payouts are dividends on common stock (Compustat annual item DVC) plus repurchases. Repurchases are the total expenditure on the purchase of common and preferred stocks (item PRSTKC) plus any reduction (negative change over the prior year) in the value of the net number of preferred stocks outstanding (item PSTKRV). Net payouts equal total payouts minus equity issuances, which are the sale of common and preferred stock (item SSTK) minus any increase (positive change over the prior year) in the value of the net number of preferred stocks outstanding (item PSTKRV). At the end of June of each year t, we sort stocks into deciles based on total payouts (net payouts) for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1 (Op and Nop, respectively). For firms with more than one share class, we merge the market equity for all share classes before computing Op and Nop. Firms with non-positive total payouts (zero net payouts) are excluded. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1. Because the data on total expenditure and the sale of common and preferred stocks start in 1971, the Op and Nop portfolios start in July 1972."
A.2.2,Bmj,Book-to-June-end market equity, Asness and Frazzini ,2013,Value-versus-growth,data_rawa['bmj'] = data_rawa['be_per'] / data_rawa['prc'] ,"# clean up csho
comp['csho'] = np.where(comp['csho'] == 0, np.nan, comp['csho'])
data_rawa['txditc'] = data_rawa['txditc'].fillna(0)
* 'ps'
data_rawa['be'] = data_rawa['seq'] + data_rawa['txditc'] - data_rawa['ps']
data_rawa['be'] = np.where(data_rawa['be'] > 0, data_rawa['be'], np.nan)
data_rawa['be_per'] = data_rawa['be'] / data_rawa['csho']
",0,1,0,0,"Following Asness and Frazzini (2013), at the end of June of each year t, we sort stocks into deciles based on Bmj, which is book equity per share for the fiscal year ending in calendar year t - 1 divided by share price (from CRSP) at the end of June of t. We adjust for any stock splits between the fiscal year end and the end of June. Book equity per share is book equity divided by the num- ber of shares outstanding (Compustat annual item CSHO). Following Davis, Fama, and French (2000), we measure book equity as stockholders' book equity, plus balance sheet deferred taxes and investment tax credit (item TXDITC) if available, minus the book value of preferred stock. Stockholders' equity is the value reported by Compustat (item SEQ), if it is available. If not, we measure stockholders' equity as the book value of common equity (item CEQ) plus the par value of preferred stock (item PSTK), or the book value of assets (item AT) minus total liabilities (item LT). Depending on availability, we use redemption (item PSTKRV), liquidating (item PSTKL), or par value (item PSTK) for the book value of preferred stock. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.2.20,Em,Enterprise multiple,Loughran and Wellman,2011,Value-versus-growth,data_rawa['em'] = data_rawa['enteprs_v'] / data_rawa['oibdp'],"* 'me' from rawa
data_rawa['enteprs_v'] = data_rawa['me'] + data_rawa['dlc'] + data_rawa['dltt'] + data_rawa['pstkrv'] - data_rawa['che']",1,1,0,0,"Enterprise multiple, Em, is enterprise value divided by operating income before depreciation (Com- pustat annual item OIBDP). Enterprise value is the market equity plus the total debt (item DLC plus item DLTT) plus the book value of preferred stocks (item PSTKRV) minus cash and short- term investments (item CHE). At the end of June of each year t, we split stocks into deciles based on Em for the fiscal year ending in calendar year t-1. The Market equity (from CRSP) is measured at the end of December of t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Em. Firms with negative enterprise value or operating income before depreciation are excluded. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.2.21,"Emq1, Emq6","Quarterly Enterprise multiple (1-month holding period), Quarterly Enterprise multiple (6-month holding period)",Loughran and Wellman,2011,Value-versus-growth,,,,,,,"Emq, is enterprise value scaled by operating income before depreciation (Compustat quarterly item OIBDPQ). Enterprise value is the market equity plus total debt (item DLCQ plus item DLTTQ) plus the book value of preferred stocks (item PSTKQ) minus cash and short-term investments (item CHEQ). At the beginning of each month t, we split stocks into deciles on Emq for the latest fiscal quarter ending at least four months ago. The Market equity (from CRSP) is measured at the end of month t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Emq. Firms with negative enterprise value or operating income before depreciation are excluded. Monthly decile returns are calculated for the current month t (Emq1), from month t to t + 5 (Emq6), and from month t to t + 11 (Emq12), and the deciles are rebalanced at the beginning of t + 1. The holding period longer than one month as in Emq6 means that for a given decile in each month there exist six subdeciles, each initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Emq6 decile. For sufficient data coverage, the EMq portfolios start in January 1975."
A.2.22,Sp,Sales-to-price,"Barbee, Mukherji, and Raines",1996,Value-versus-growth,data_rawq['sp'] = data_rawq['saleq4']/data_rawq['me'],"data_rawq['saleq4'] = ttm4('saleq', data_rawq)
data_rawq['saleq4'] = np.where(data_rawq['saleq4'].isnull(), data_rawq['saley'], data_rawq['saleq4'])
* 'me' from rawq",1,0,1,0,"At the end of June of each year t, we sort stocks into deciles based on sales-to-price, Sp, which is sales (Compustat annual item SALE) for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Sp. Firms with non-positive sales are excluded. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.2.23,"Sp q 1, Sp q 6, and Sp q 12",Quarterly Sales-to-price,"Barbee, Mukherji, and Raines",1996,Value-versus-growth,,,,,,,"At the beginning of each month t, we sort stocks into deciles based on quarterly sales-to-price, Spq, which is sales (Compustat quarterly item SALEQ) divided by the market equity at the end of month t - 1. Before 1972, we use quarterly sales from fiscal quarters ending at least four months prior to the portfolio formation. Starting from 1972, we use quarterly sales from the most recent quarterly earnings announcement dates (item RDQ). Sales are generally announced with earnings during quarterly earnings announcements (Jegadeesh and Livnat 2006). For a firm to enter the portfolio formation, we require the end of the fiscal quarter that corresponds to its most recent quarterly sales to be within six months prior to the portfolio formation. This restriction is imposed to exclude stale earnings information. To avoid potentially erroneous records, we also require the earnings announcement date to be after the corresponding fiscal quarter end. Firms with non- positive sales are excluded. For firms with more than one share class, we merge the market equity for all share classes before computing Spq. Monthly decile returns are calculated for the current month t (Spq1), from month t to t + 5 (Spq6), and from month t to t + 11 (Spq12), and the deciles are rebalanced at the beginning of t + 1. The holding period longer than one month as in Spq6 means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Spq6 decile."
A.2.24,Ocp,Operating Cash Flow-to-price,"Desai, Rajgopal, and Venkatachalam",2004,Value-versus-growth,"data_rawa['ocp'] = data_rawa['ocy'] / data_rawa['me']
data_rawa['ocp'] = np.where(data_rawa['ocp']<=0, np.nan, data_rawa['ocp'] )","* 'me' from rawa
data_rawa['ocy'] = np.where(data_rawa['jdate'] < '1988-06-30', data_rawa['fopt'] - data_rawa['wcap'], data_rawa['fopt'] - data_rawa['oancf'])",1,1,0,0,"At the end of June of each year t, we sort stocks into deciles based on operating cash flows-to-price, Ocp, which is operating cash flows for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1. Operating cash flows are measured as funds from operation (Compustat annual item FOPT) minus change in working capital (item WCAP) prior to 1988, and then as net cash flows from operating activities (item OANCF) stating from 1988. For firms with more than one share class, we merge the market equity for all share classes before computing Ocp. Firms with non-positive operating cash flows are excluded. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t+1. Because the data on funds from operation start in 1971, the Ocp portfolios start in July 1972.
"
A.2.26,Ir,Intangible Return,Daniel and Titman,2006,Value-versus-growth,"
#Regression and get ir
#First get unique datelist
datelist = data_rawa['jdate'].unique()
for date in datelist:
    temp = data_rawa[data_rawa['jdate'] == date]
    n_row = temp.shape[0]
    index = temp.index
    X = pd.DataFrame()
    X['bm5'] = temp['bm5']
    X['rB'] = temp['rB']
    X['intercept'] = 1
    X = X[['intercept','rB','bm5']]
    X = np.mat(X)
    Y = np.mat(temp[['ret5']])
    #These are residuals on one date
    res = (np.identity(n_row) - X.dot(X.T.dot(X).I).dot(X.T)).dot(Y)
    #put residuals back into data_rawa
    data_rawa.loc[index,'ir'] = res","* 'bm' from rawa
#ir
'''
#First calculate r(t-5,t). Then rb(t-5,t) and use Bm to perform linear regression and get residue
'''
#r(t-5,t):sum ret from t-5 to t (which is calendar year t-6 to t-1)
lag = pd.DataFrame()
for i in range(1,6):
        lag['ret%s' % i] = data_rawa.groupby(['permno'])['ret'].shift(i)

data_rawa['ret5'] = lag['ret1']+lag['ret2']+lag['ret3']+lag['ret4']+lag['ret5']

#bm_t-5 (bm of year t-5)
data_rawa['bm5'] = data_rawa.groupby(['permno'])['bm'].shift(5)

#rB (five year log book return)
#Reference: jf_06 page8 by KENT DANIEL
data_rawa['rB'] = data_rawa['bm'] - data_rawa['bm5'] + data_rawa['ret5']
",1,1,0,0,p77
A.2.28,Ebp,Enterprise Book-to-price,"Penman, Richardson, and Tuna",2007,Value-versus-growth,data_rawa['ebp'] = (data_rawa['n_debt']+data_rawa['ber']) / (data_rawa['n_debt']+data_rawa['me']),"* 'me' from rawa
#Ebp
data_rawa['dvpa'] = np.where(data_rawa['dvpa'].isnull(), 0, data_rawa['dvpa'])
data_rawa['tstkp'] = np.where(data_rawa['tstkp'].isnull(), 0, data_rawa['tstkp'])
data_rawa['f_liab'] = data_rawa['dltt'] + data_rawa['dlc'] + data_rawa['pstk'] + data_rawa['dvpa'] - data_rawa['tstkp']
data_rawa['f_asse'] = data_rawa['che']
# net debt : = 铿乶ancial liabilities - 铿乶ancial assets.
data_rawa['n_debt'] = data_rawa['f_liab'] - data_rawa['f_asse']
data_rawa['ber'] = data_rawa['ceq'] + data_rawa['tstkp'] - data_rawa['dvpa']",1,1,0,0,"Following Penman, Richardson, and Tuna (2007), we measure enterprise book-to-price, Ebp, as the ratio of the book value of net operating assets (net debt plus book equity) to the market value of net operating assets (net debt plus market equity). Net Debt-to-price, Ndp, is the ratio of net debt to the market equity. Net debt is financial liabilities minus financial assets. We measure financial liabilities as the sum of long-term debt (Compustat annual item DLTT), debt in current liabilities (item DLC), carrying value of preferred stock (item PSTK), and preferred dividends in arrears (item DVPA, zero if missing), less preferred treasury stock (item TSTKP, zero if missing). We measure financial assets as cash and short-term investments (item CHE). Book equity is common equity (item CEQ) plus any preferred treasury stock (item TSTKP, zero if missing) less any pre- ferred dividends in arrears (item DVPA, zero if missing). Market equity is the number of common shares outstanding times share price (from CRSP).
At the end of June of each year t, we sort stocks into deciles based on Ebp, and separately, on Ndp, for the fiscal year ending in calendar year t - 1. Market equity is measured at the end of December of t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Ebp and Ndp. When forming the Ebp portfolios, we exclude firms with non-positive book or market value of net operating assets. For the Ndp portfolios, we exclude firms with non-positive net debt. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.2.3,Bmq12,Quarterly Book-to-market Equity (12-month holding period),"Rosenberg, Reid, and Lanstein ",1985,Value-versus-growth,,,,,,,p70
A.2.9,Ep,Earnings-to-price,Basu,1983,Value-versus-growth,data_rawq['ep'] = data_rawq['ibq4']/data_rawq['me'],"data_rawq['ibq4'] = ttm4('ibq', data_rawq)
* 'me' from rawq
",1,0,1,0,"At the end of June of each year t, we split stocks into deciles based on earnings-to-price, Ep, which is income before extraordinary items (Compustat annual item IB) for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1. For firms with more than one share class, we merge the market equity for all share classes before com- puting Ep. Firms with non-positive earnings are excluded. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.1,Aci,Abnormal Corporate Investment,"Titman, Wei, and Xie",2004,Investment,data_rawa['aci'] = data_rawa['ce']/ (data_rawa['ce1']+data_rawa['ce2']+data_rawa['ce3'])-1,"data_rawa['ce'] = data_rawa['capx'] / data_rawa['sale']
data_rawa['ce1'] = data_rawa['ce'].shift(1)
data_rawa['ce2'] = data_rawa['ce'].shift(2)
data_rawa['ce3'] = data_rawa['ce'].shift(3)",0,1,0,0,"At the end of June of year t, we measure abnormal corporate investment, Aci, as Cet-1/[(Cet-2 + Cet-3 + Cet-4)/3] - 1, in which Cet-j is capital expenditure (Compustat annual item CAPX) scaled by sales (item SALE) for the fiscal year ending in calendar year t - j. The last three-year average capital expenditure is designed to project the benchmark investment in the portfolio formation year. We exclude firms with sales less than ten million dollars. At the end of June of each year t, we sort stocks into deciles based on Aci. Monthly decile returns are computed from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.10,Nsi,Net Stock Issues,Pontiﬀ and Woodgate,2008,Investment,data_rawa['nsi'] = np.log(data_rawa['sps']/data_rawa['sps_l1']),"data_rawa['sps'] = data_rawa['csho'] * data_rawa['ajex']
data_rawa['sps_l1'] = data_rawa.groupby('permno')['sps'].shift(1)",0,1,0,0,"At the end of June of year t, we measure net stock issues, Nsi, as the natural log of the ratio of the split-adjusted shares outstanding at the fiscal year ending in calendar year t-1 to the split-adjusted shares outstanding at the fiscal year ending in t-2. The split-adjusted shares outstanding is shares outstanding (Compustat annual item CSHO) times the adjustment factor (item AJEX). At the end of June of each year t, we sort stocks with negative Nsi into two portfolios (1 and 2), stocks with zero Nsi into one portfolio (3), and stocks with positive Nsi into seven portfolios (4 to 10). Monthly decile returns are from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.11,dIi,% Change in Investment - % Change in Industry Investment,Abarbanell and Bushee,1998,Investment,data_rawa['dIi'] = data_rawa['dinvt'] - data_rawa['dind'],"data_rawa['e_invt'] = (data_rawa['capxv'] + data_rawa['capxv'].shift(1))/2
data_rawa['dinvt'] = (data_rawa['capxv'] - data_rawa['e_invt']) / data_rawa['e_invt']

data_rawa['ind'] = data_rawa['capxv']
s = data_rawa.groupby(['jdate', 'sic2'])['ind'].sum()
data_rawa = pd.merge(data_rawa, s, on=['jdate', 'sic2'])
# new industry investment will be named as ind_y, cause it's been grouped by ind
data_rawa['e_ind'] = (data_rawa['ind_y'] + data_rawa['ind_y'].shift(1))/2
data_rawa['dind'] = (data_rawa['ind_y']-data_rawa['e_ind']) / data_rawa['e_ind']",0,1,0,0,"Following Abarbanell and Bushee (1998), we define the %d(.) operator as the percentage change in the variable in the parentheses from its average over the prior two years, e.g., %d(Investment) = [Investment(t) - E[Investment(t)]]/E[Investment(t)], in which E[Investment(t)] = [Investment(t-1) + Investment(t - 2)]/2. dIi is defined as %d(Investment) - %d(Industry investment), in which investment is capital expenditure in property, plant, and equipment (Compustat annual item CAPXV). Industry investment is the aggregate investment across all firms with the same two- digit SIC code. Firms with non-positive E[Investment(t)] are excluded and we require at least two firms in each industry. At the end of June of each year t, we sort stocks into deciles based on dIi for the fiscal year ending in calendar year t - 1. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.14,Ivg,Inventory Growth,Belo and Lin,2011,Investment,,,,,,,"At the end of June of each year t, we sort stocks into deciles based on inventory growth, Ivg, which is the annual growth rate in inventory (Compustat annual item INVT) from the fiscal year ending in calendar year t - 2 to the fiscal year ending in t - 1. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.15,Ivc,Inventory Changes,Thomas and Zhang,2002,Investment,data_rawa['ivc'] = data_rawa['invt'] / data_rawa['atAvg'],"data_rawa['at_l1'] = data_rawa.groupby(['permno'])['at'].shift(1)
data_rawa['atAvg'] = (data_rawa['at']+data_rawa['at_l1'])/2",1,1,0,0,"At the end of June of each year t, we sort stocks into deciles based on inventory changes, Ivc, which is the annual change in inventory (Compustat annual item INVT) scaled by the average of total assets (item AT) for the fiscal years ending in t - 2 and t - 1. We exclude firms that carry no inventory for the past two fiscal years. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.16,Oa(acc),Operating Accruals,Sloan,1996,Investment,"data_rawq['acc'] = np.select(condlist, choicelist,
                          default=((data_rawq['actq']-data_rawq['lctq']+data_rawq['npq'])-
                                   (data_rawq['actq_l4']-data_rawq['lctq_l4']+data_rawq['npq_l4']))/(10*data_rawq['beq']))
","#prepare be
data_rawq['beq'] = np.where(data_rawq['seqq']>0, data_rawq['seqq']+data_rawq['txditcq']-data_rawq['pstkq'], np.nan)
data_rawq['beq'] = np.where(data_rawq['beq']<=0, np.nan, data_rawq['beq'])
# acc
data_rawq['actq_l4'] = data_rawq.groupby(['permno'])['actq'].shift(4)
data_rawq['lctq_l4'] = data_rawq.groupby(['permno'])['lctq'].shift(4)
data_rawq['npq_l4'] = data_rawq.groupby(['permno'])['npq'].shift(4)
condlist = [data_rawq['npq'].isnull(),
            data_rawq['actq'].isnull() | data_rawq['lctq'].isnull()]
choicelist = [((data_rawq['actq']-data_rawq['lctq'])-(data_rawq['actq_l4']-data_rawq['lctq_l4']))/(10*data_rawq['beq']),
              np.nan]",0,0,1,0,"Prior to 1988, we use the balance sheet approach in Sloan (1996) to measure operating accruals, Oa, as changes in noncash working capital minus depreciation, in which the noncash working capital is changes in noncash current assets minus changes in current liabilities less short-term debt and taxes payable. In particular, Oa equals (dCA-dCASH)-(dCL-dSTD-dTP)-DP, in which dCA is the change in current assets (Compustat annual item ACT), dCASH is the change in cash or cash equiv- alents (item CHE), dCL is the change in current liabilities (item LCT), dSTD is the change in debt included in current liabilities (item DLC), dTP is the change in income taxes payable (item TXP), and DP is depreciation and amortization (item DP). Missing changes in income taxes payable are set to zero. Starting from 1988, we follow Hribar and Collins (2002) to measure Oa using the state- ment of cash flows as net income (item NI) minus net cash flow from operations (item OANCF). Doing so helps mitigate measurement errors that can arise from nonoperating activities such as ac- quisitions and divestitures. Data from the statement of cash flows are only available since 1988. At the end of June of each year t, we sort stocks into deciles on Oa for the fiscal year ending in calendar year t - 1 scaled by total assets (item AT) for the fiscal year ending in t - 2. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1.
"
A.3.17,Ta,Total Accruals,"Richardson, Sloan, Soliman, and Tuna",2005,Investment,data_rawa['ta'] = data_rawa['dwc'] + data_rawa['dnco'] + data_rawa['dfin'],"#dwc
data_rawa['dwc'] = (data_rawa['act'] - data_rawa['che']) - (data_rawa['lct'] - data_rawa['dlc'])
* dnco
* dfin
",0,1,0,0,"Prior to 1988, we use the balance sheet approach in Richardson, Sloan, Soliman, and Tuna (2005) to measure total accruals, Ta, as dWc + dNco + dFin. dWc is the change in net non-cash working capital. Net non-cash working capital is current operating asset (Coa) minus current operating liabilities (Col), with Coa = current assets (Compustat annual item ACT) - cash and short-term investments (item CHE) and Col = current liabilities (item LCT) - debt in current liabilities (item DLC). dNco is the change in net non-current operating assets. Net non-current operating assets are non-current operating assets (Nca) minus non-current operating liabilities (Ncl), with Nca = total assets (item AT) - current assets - long-term investments (item IVAO), and Ncl = total liabilities (item LT) - current liabilities - long-term debt (item DLTT). dFin is the change in net financial assets. Net financial assets are financial assets (Fna) minus financial liabilities (Fnl), with Fna = short-term investments (item IVST) + long-term investments, and Fnl = long-term debt + debt in current liabilities + preferred stocks (item PSTK). Missing changes in debt in current liabilities, long-term investments, long-term debt, short-term investments, and preferred stocks are set to zero.
Starting from 1988, we use the cash flow approach to measure Ta as net income (item NI) minus total operating, investing, and financing cash flows (items OANCF, IVNCF, and FINCF) plus sales of stocks (item SSTK, zero if missing) minus stock repurchases and dividends (items PRSTKC and DV, zero if missing). Data from the statement of cash flows are only available since 1988. At the end of June of each year t, we sort stocks into deciles based on Ta for the fiscal year ending in calendar year t - 1 scaled by total assets for the fiscal year ending in t - 2. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.18,dCoa,changes in Current Operating Assets,"Richardson, Sloan, Soliman, and Tuna",2005,Investment,data_rawa['dcoa'] = (data_rawa['coa']-data_rawa['coa'].shift(1)) / data_rawa['at'].shift(1),"# dCoa
data_rawa['coa'] = data_rawa['act'] - data_rawa['che']",0,1,0,0,"Richardson, Sloan, Soliman, and Tuna (2005, Table 10) show that several components of total accruals also forecast returns in the cross section. dWc is the change in net non-cash working capital. Net non-cash working capital is current operating asset (Coa) minus current operating liabilities (Col), with Coa = current assets (Compustat annual item ACT) - cash and short term investments (item CHE) and Col = current liabilities (item LCT) - debt in current liabilities (item DLC). dCoa is the change in current operating asset and dCol is the change in current operating liabilities. Missing changes in debt in current liabilities are set to zero. At the end of June of each year t, we sort stocks into deciles based, separately, on dWc, dCoa, and dCol for the fiscal year ending in calendar year t - 1, all scaled by total assets (item AT) for the fiscal year ending in calendar year t - 2. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.19,dNca,changes in Non-current Operating Assets,"Richardson, Sloan, Soliman, and Tuna",2005,Investment,data_rawa['dnca'] = data_rawa['nco'] - data_rawa['nco'].shift(1),"# dNca
data_rawa['ivao_0'] = np.where(data_rawa['ivao'].isnull(), 0, data_rawa['ivao'])
data_rawa['dltt_0'] = np.where(data_rawa['dltt'].isnull(), 0, data_rawa['dltt'])
data_rawa['nca'] = data_rawa['at'] - data_rawa['act'] - data_rawa['ivao_0']
data_rawa['ncl'] = data_rawa['lt'] - data_rawa['lct'] - data_rawa['dltt_0'] 
data_rawa['nco'] = data_rawa['nca'] - data_rawa['ncl']
",0,1,0,0,"dNco is the change in net non-current operating assets. Net non-current operating assets are non- current operating assets (Nca) minus non-current operating liabilities (Ncl), with Nca = total assets (Compustat annual item AT) - current assets (item ACT) - long-term investments (item IVAO), and Ncl = total liabilities (item LT) - current liabilities (item LCT) - long-term debt (item DLTT). dNca is the change in non-current operating assets and dNcl is the change in non-current operating liabilities. Missing changes in long-term investments and long-term debt are set to zero. At the end of June of each year t, we sort stocks into deciles based, separately, on dNco, dNca, and dNcl for the fiscal year ending in calendar year t - 1, all scaled by total assets for the fiscal year ending in calendar year t - 2. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.19,dNco,Changes in Net Non-current Operating Assets,"Richardson, Sloan, Soliman, and Tuna",2005,Investment,data_rawa['dnco'] = data_rawa['nco'] - data_rawa['nco'].shift(1),"# dNco
data_rawa['nca'] = data_rawa['at'] - data_rawa['act'] - data_rawa['ivao']
data_rawa['ncl'] = data_rawa['lt'] - data_rawa['lct'] - data_rawa['dltt'] 
data_rawa['nco'] = data_rawa['nca'] - data_rawa['ncl']",0,1,0,0,"dNco is the change in net non-current operating assets. Net non-current operating assets are non- current operating assets (Nca) minus non-current operating liabilities (Ncl), with Nca = total assets (Compustat annual item AT) - current assets (item ACT) - long-term investments (item IVAO), and Ncl = total liabilities (item LT) - current liabilities (item LCT) - long-term debt (item DLTT). dNca is the change in non-current operating assets and dNcl is the change in non-current operating liabilities. Missing changes in long-term investments and long-term debt are set to zero. At the end of June of each year t, we sort stocks into deciles based, separately, on dNco, dNca, and dNcl for the fiscal year ending in calendar year t - 1, all scaled by total assets for the fiscal year ending in calendar year t - 2. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.2,I/A, Investment-to-assets,"Cooper, Gulen, and Schill",2008,Investment,data_rawa['ia'] = (data_rawa['at']/data_rawa['at_l1'])-1,data_rawa['at_l1'] = data_rawa.groupby(['permno'])['at'].shift(1),1,1,0,0,"At the end of June of each year t, we sort stocks into deciles based on investment-to-assets, I/A, which is measured as total assets (Compustat annual item AT) for the fiscal year ending in calendar year t-1 divided by total assets for the fiscal year ending in t-2 minus one. Monthly decile returns are computed from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.20,dBe,Changes in Net Financial Assets,"Richardson, Sloan, Soliman, and Tuna",2005,Investment,data_rawa['dBe'] = (data_rawa['ceq'] - data_rawa['ceq'].shift(1)) / data_rawa['at'].shift(1),,0,1,0,0,"dFin is the change in net financial assets. Net financial assets are financial assets (Fna) minus financial liabilities (Fnl), with Fna = short-term investments (Compustat annual item IVST) + long-term investments (item IVAO), and Fnl = long-term debt (item DLTT) + debt in current liabilities (item DLC) + preferred stock (item PSTK). dSti is the change in short-term investments, dLti is the change in long-term investments, and dFnl is the change in financial liabilities. dBe is the change in book equity (item CEQ). Missing changes in debt in current liabilities, long-term investments, long-term debt, short-term investments, and preferred stocks are set to zero (at least one change has to be non-missing when constructing any variable). When constructing dSti (dLti), we exclude firms that do not have long-term (short-term) investments in the past two fiscal years. At the end of June of each year t, we sort stocks into deciles based, separately, on dFin, dSti, dLti, dFnl, and dBe for the fiscal year ending in calendar year t - 1, all scaled by total assets (item AT) for the fiscal year ending in calendar year t - 2. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.20,dFin,changes in Financial Liabilities,"Richardson, Sloan, Soliman, and Tuna",2005,Investment,data_rawa['dfin'] = data_rawa['dfin'] / data_rawa['at'].shift(1),"data_rawa['fna'] = data_rawa['ivst'] + data_rawa['ivao']
data_rawa['fnl'] = data_rawa['dltt'] + data_rawa['dlc'] + data_rawa['pstk']

data_rawa['d_dlc'] = data_rawa['dlc'] - data_rawa['dlc'].shift(1)
data_rawa['d_dlc'] = np.where(data_rawa['d_dlc'].isnull(), 0, data_rawa['d_dlc'])
data_rawa['d_pstk'] = data_rawa['pstk'] - data_rawa['pstk'].shift(1)
data_rawa['d_pstk'] = np.where(data_rawa['d_pstk'].isnull(), 0, data_rawa['d_pstk'])

data_rawa['dfnl'] = (data_rawa['dltt']-data_rawa['dltt'].shift(1)) + data_rawa['d_dlc'] + data_rawa['d_pstk']

data_rawa['d_ivst'] = data_rawa['ivst'] - data_rawa['ivst'].shift(1)
data_rawa['d_ivst'] = np.where(data_rawa['d_ivst'].isnull(), 0, data_rawa['d_ivst'])
data_rawa['d_ivao'] = data_rawa['ivao'] - data_rawa['ivao'].shift(1)
data_rawa['d_ivao'] = np.where(data_rawa['d_ivao'].isnull(), 0, data_rawa['d_ivao'])

data_rawa['dfna'] = data_rawa['d_ivst'] + data_rawa['d_ivao']
data_rawa['dfin'] = data_rawa['dfna'] - data_rawa['dfnl']",0,1,0,0,"dFin is the change in net financial assets. Net financial assets are financial assets (Fna) minus financial liabilities (Fnl), with Fna = short-term investments (Compustat annual item IVST) + long-term investments (item IVAO), and Fnl = long-term debt (item DLTT) + debt in current liabilities (item DLC) + preferred stock (item PSTK). dSti is the change in short-term investments, dLti is the change in long-term investments, and dFnl is the change in financial liabilities. dBe is the change in book equity (item CEQ). Missing changes in debt in current liabilities, long-term investments, long-term debt, short-term investments, and preferred stocks are set to zero (at least one change has to be non-missing when constructing any variable). When constructing dSti (dLti), we exclude firms that do not have long-term (short-term) investments in the past two fiscal years. At the end of June of each year t, we sort stocks into deciles based, separately, on dFin, dSti, dLti, dFnl, and dBe for the fiscal year ending in calendar year t - 1, all scaled by total assets (item AT) for the fiscal year ending in calendar year t - 2. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.20,dFnl,changes in Book Equity,"Richardson, Sloan, Soliman, and Tuna",2005,Investment,data_rawa['dfnl'] = data_rawa['dfnl'] / data_rawa['at'].shift(1),* dfnl in dFin,0,1,0,0,"dFin is the change in net financial assets. Net financial assets are financial assets (Fna) minus financial liabilities (Fnl), with Fna = short-term investments (Compustat annual item IVST) + long-term investments (item IVAO), and Fnl = long-term debt (item DLTT) + debt in current liabilities (item DLC) + preferred stock (item PSTK). dSti is the change in short-term investments, dLti is the change in long-term investments, and dFnl is the change in financial liabilities. dBe is the change in book equity (item CEQ). Missing changes in debt in current liabilities, long-term investments, long-term debt, short-term investments, and preferred stocks are set to zero (at least one change has to be non-missing when constructing any variable). When constructing dSti (dLti), we exclude firms that do not have long-term (short-term) investments in the past two fiscal years. At the end of June of each year t, we sort stocks into deciles based, separately, on dFin, dSti, dLti, dFnl, and dBe for the fiscal year ending in calendar year t - 1, all scaled by total assets (item AT) for the fiscal year ending in calendar year t - 2. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.22,Poa,Percent operating accruals,"Hafzalla, Lundholm, and Van Winkle",2011,Investment,data_rawa['poa'] = data_rawa['oa']/data_rawa['ni'],* oa(acc),0,1,0,0,"Accruals are traditionally scaled by total assets. Hafzalla, Lundholm, and Van Winkle (2011) show that scaling accruals by the absolute value of earnings (percent accruals) is more effective in se- lecting firms for which the differences between sophisticated and naive forecasts of earnings are the most extreme. To construct the percent operating accruals (Poa) deciles, at the end of June of each year t, we sort stocks into deciles based on operating accruals scaled by the absolute value of net income (Compustat annual item NI) for the fiscal year ending in calendar year t - 1. See Appendix A.3.16 for the measurement of operating accruals. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.23,Pta,Percent total accruals,"Hafzalla, Lundholm, and Van Winkle",2011,Investment,,,,,,,"At the end of June of each year t, we sort stocks into deciles on percent total accruals, Pta, cal- culated as total accruals scaled by the absolute value of net income (Compustat annual item NI) for the fiscal year ending in calendar year t - 1. See Appendix A.3.17 for the measurement of total accruals. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of year t + 1."
A.3.24,Pda,Percent discretionary accruals,,,Investment,,,,,,,"At the end of June of each year t, we split stocks into deciles based on percent discretionary accruals, Pda, calculated as the discretionary accruals, Dac, for the fiscal year ending in calendar year t - 1 multiplied with total assets (Compustat annual item AT) for the fiscal year ending in t - 2 scaled by the absolute value of net income (item NI) for the fiscal year ending in t - 1. See Appendix A.3.21 for the measurement of discretionary accruals. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.25,Ndf,Net debt ﬁnance,"Bradshaw, Richardson, and Sloan",2006,Investment,data_rawa['ndf'] = data_rawa['dltis'] - data_rawa['dltr'] + data_rawa['dlcch'] ,,0,1,0,0,"Net external financing, Nxf, is the sum of net equity financing, Nef, and net debt financing, Ndf (Bradshaw, Richardson, and Sloan 2006). Nef is the proceeds from the sale of common and pre- ferred stocks (Compustat annual item SSTK) less cash payments for the repurchases of common and preferred stocks (item PRSTKC) less cash payments for dividends (item DV). Ndf is the cash proceeds from the issuance of long-term debt (item DLTIS) less cash payments for long-term debt reductions (item DLTR) plus the net changes in current debt (item DLCCH, zero if missing). At the end of June of each year t, we sort stocks into deciles based on Nxf, and, separately, on Nef and Ndf, for the fiscal year ending in calendar year t - 1 scaled by the average of total assets for fiscal years ending in t - 2 and t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1. Because the data on financing activities start in 1971, the portfolios start in July 1972."
A.3.3,"Ia q 6, and Ia q 12",Quarterly Investment-to-assets,"Cooper, Gulen, and Schill",2008,Investment,data_rawq['iaq'] = (data_rawq['atq']/data_rawq['atqlag'])-1,"data_rawq['atqlag'] = ttm4('atq',data_rawq)",0,0,1,0,"Quarterly investment-to-assets, Iaq, is defined as quarterly total assets (Compustat quarterly item ATQ) divided by four-quarter-lagged total assets minus one. At the beginning of each month t, we sort stocks into deciles based on Iaq for the latest fiscal quarter ending at least four months ago. Monthly decile returns are calculated for the current month t (Iaq1), from month t to t + 5 (Iaq6), and from month t to t + 11 (Iaq12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in, for instance, Iaq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Iaq6 decile."
A.3.4,dPia,Changes in PPE and Inventory-to-assets,"Lyandres, Sun, and Zhang",2008,Investment,data_rawa['dpia'] = (data_rawa['c_propty'] + data_rawa['c_invt']) / data_rawa['at'].shift(1),"data_rawa['c_propty'] = data_rawa['ppegt'] - data_rawa['ppegt'].shift(1)
data_rawa['c_invt'] = data_rawa['invt'] - data_rawa['invt'].shift(1)",0,1,0,0,"Changes in PPE and Inventory-to-assets, dPia, is defined as the annual change in gross property, plant, and equipment (Compustat annual item PPEGT) plus the annual change in inventory (item INVT) scaled by one-year-lagged total assets (item AT). At the end of June of each year t, we sort stocks into deciles based on dPia for the fiscal year ending in calendar year t-1. Monthly decile re- turns are computed from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.3.5,Noa and dNoa,(Changes in) Net Operating Assets,"Hirshleifer, Hou, Teoh, and Zhang",2004,Investment,"data_rawq['noa'] = (data_rawq['atq']-data_rawq['cheq']-data_rawq['ivaoq'])-\
                 (data_rawq['atq']-data_rawq['dlcq']-data_rawq['dlttq']-data_rawq['mibq']-data_rawq['pstkq']-data_rawq['ceqq'])/data_rawq['atq_l4']
data_rawa['dnoa'] = (data_rawa['net_op']-data_rawa['net_op'].shift(1))/ data_rawa['at'].shift(1)
","#noa
data_rawq['atq_l4'] = data_rawq.groupby(['permno'])['atq'].shift(4)
data_rawq['ivaoq'] = np.where(data_rawq['ivaoq'].isnull(), 0, 1)
data_rawq['dlcq'] = np.where(data_rawq['dlcq'].isnull(), 0, 1)
data_rawq['dlttq'] = np.where(data_rawq['dlttq'].isnull(), 0, 1)
data_rawq['mibq'] = np.where(data_rawq['mibq'].isnull(), 0, 1)
data_rawq['pstkq'] = np.where(data_rawq['pstkq'].isnull(), 0, 1)
# dNoa
data_rawa['dlc_0'] = np.where(data_rawa['dlc'].isnull(), 0, data_rawa['dlc'])
data_rawa['dltt_0'] = np.where(data_rawa['dltt'].isnull(), 0, data_rawa['dltt'])
data_rawa['mib_0'] = np.where(data_rawa['mib'].isnull(), 0, data_rawa['mib'])
data_rawa['pstk_0'] = np.where(data_rawa['pstk'].isnull(), 0, data_rawa['pstk'])

data_rawa['op_at'] = data_rawa['at'] - data_rawa['che']
data_rawa['op_lia'] = data_rawa['at'] - data_rawa['dlc_0'] - data_rawa['dltt_0'] - data_rawa['mib_0'] - data_rawa['pstk_0'] - data_rawa['ceq']
data_rawa['net_op'] = data_rawa['op_at'] - data_rawa['op_lia']",1,1,1,0,"Following Hirshleifer, Hou, Teoh, and Zhang (2004), we measure net operating assets as operating assets minus operating liabilities. Operating assets are total assets (Compustat annual item AT) minus cash and short-term investment (item CHE). Operating liabilities are total assets minus debt included in current liabilities (item DLC, zero if missing), minus long-term debt (item DLTT, zero if missing), minus minority interests (item MIB, zero if missing), minus preferred stocks (item PSTK, zero if missing), and minus common equity (item CEQ). Noa is net operating assets scalded by one-year-lagged total assets. Changes in net operating assets, dNoa, is the annual change in net operating assets scaled by one-year-lagged total assets. At the end of June of each year t, we sort stocks into deciles based on Noa, and separately, on dNOA, for the fiscal year ending in calendar year t - 1. Monthly decile returns are computed from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.6,dLno,Changes in Long-term Net Operating Assets,"Fairﬁeld, Whisenant, and Yohn",2003,Investment,"data_rawa['dlno'] = (data_rawa['ppent']-data_rawa['ppent'].shift(1)) + (data_rawa['intan']-data_rawa['intan'].shift(1)) + (data_rawa['ao']-data_rawa['ao'].shift(1)) - (data_rawa['lo']-data_rawa['lo'].shift(1)) + data_rawa['dp'] 
*
data_rawa['dlno'] = data_rawa['dlno'] / data_rawa['avg_at']","*
avg_at = []
for i in range(data_rawa.shape[0]):
  avg_at.append(data_rawa.loc[0:i, 'at'].mean())
data_rawa['avg_at'] = pd.DataFrame(avg_at)",0,1,0,0,"Following Fairfield, Whisenant, and Yohn (2003), we measure changes in long-term net operating assets as the annual change in net property, plant, and equipment (Compustat item PPENT) plus the change in intangibles (item INTAN) plus the change in other long-term assets (item AO) minus the change in other long-term liabilities (item LO) and plus depreciation and amortization expense (item DP). dLno is the change in long-term net operating assets scaled by the average of total assets (item AT) from the current and prior years. At the end of June of each year t, we sort stocks into deciles based on dLno for the fiscal year ending in calendar year t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.7,Ig,Investment Growth,Xing,2008,Investment,data_rawa['ig'] = data_rawa['capx']/data_rawa['capx_l1'],data_rawa['capx_l1'] = data_rawa.groupby('permno')['capx'].shift(1),1,1,0,0,"At the end of June of each year t, we sort stocks into deciles based on investment growth, Ig, which is the growth rate in capital expenditure (Compustat annual item CAPX) from the fiscal year ending in calendar year t - 2 to the fiscal year ending in t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.3.8,2Ig,2-year Investment Growth,Anderson and Garcia-Feijoo,2006,Investment,data_rawa['2ig'] = data_rawa['capx']/data_rawa['capx_l2'],data_rawa['capx_l2'] = data_rawa.groupby('permno')['capx'].shift(2),0,1,0,0,"At the end of June of each year t, we sort stocks into deciles based on two-year investment growth, 2Ig, which is the growth rate in capital expenditure (Compustat annual item CAPX) from the fiscal year ending in calendar year t - 3 to the fiscal year ending in t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.1,"Roe1, Roe6",Return on Equity,"Hou, Xue, and Zhang",2015,Profitability,data_rawq['roe'] = data_rawq['ibq']/data_rawq['ceqq_l1'],data_rawq['ceqq_l1'] = data_rawq.groupby(['permno'])['ceqq'].shift(1),1,0,1,0,"Return on equity, Roe, is income before extraordinary items (Compustat quarterly item IBQ) di- vided by one-quarter-lagged book equity (Hou, Xue, and Zhang 2015). Book equity is shareholders' equity, plus balance sheet deferred taxes and investment tax credit (item TXDITCQ) if available, minus the book value of preferred stock (item PSTKQ). Depending on availability, we use stockhold- ers' equity (item SEQQ), or common equity (item CEQQ) plus the book value of preferred stock, or total assets (item ATQ) minus total liabilities (item LTQ) in that order as shareholders' equity."
A.4.11,"Gla q 1, Gla q 6, and Gla q 12",Quarterly Gross Proﬁts-to-lagged Assets,,,Profitability,,,,,,,"Glaq, is quarterly total revenue (Compustat quarterly item REVTQ) minus cost of goods sold (item COGSQ) divided by one-quarter-lagged total assets (item ATQ). At the beginning of each month t, we sort stocks into deciles based on Glaq for the fiscal quarter ending at least four months ago. Monthly decile returns are calculated for month t (Glaq1), from month t to t+5 (Glaq6), and from month t to t + 11 (Glaq12). The deciles are rebalanced at the beginning of t + 1. The holding period that is longer than one month as in, for instance, Glaq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdecile returns as the monthly return of the Glaq6 decile. For sufficient data coverage, the Glaq portfolios start in January 1976."
A.4.12,Ope(operprof),Operating Proﬁts to Equity,Fama and French,2015,Profitability,data_rawa['operprof'] = (data_rawa['revt']-data_rawa['cogs']-data_rawa['xsga0']-data_rawa['xint0'])/data_rawa['ceq_l1'],"data_rawa['cogs0'] = np.where(data_rawa['cogs'].isnull(), 0, data_rawa['cogs'])
data_rawa['xint0'] = np.where(data_rawa['xint'].isnull(), 0, data_rawa['xint'])
data_rawa['xsga0'] = np.where(data_rawa['xsga'].isnull(), 0, data_rawa['xsga'])",0,1,0,0,"Following Fama and French (2015), we measure operating profitability to equity, Ope, as total rev- enue (Compustat annual item REVT) minus cost of goods sold (item COGS, zero if missing), minus selling, general, and administrative expenses (item XSGA, zero if missing), and minus interest ex- pense (item XINT, zero if missing), scaled by book equity (the denominator is current, not lagged, book equity). We require at least one of the three expense items (COGS, XSGA, and XINT) to be non-missing. Book equity is stockholders' book equity, plus balance sheet deferred taxes and investment tax credit (item TXDITC) if available, minus the book value of preferred stock. Stock- holders' equity is the value reported by Compustat (item SEQ), if it is available. If not, we measure stockholders' equity as the book value of common equity (item CEQ) plus the par value of preferred stock (item PSTK), or the book value of assets (item AT) minus total liabilities (item LT). Depend- ing on availability, we use redemption (item PSTKRV), liquidating (item PSTKL), or par value (item PSTK) for the book value of preferred stock. At the end of June of each year t, we sort stocks into deciles based on Ope for the fiscal year ending in calendar year t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.14,"Ole q 1, Ole q 6 ",Quarterly Operating Proﬁts-to-lagged Equity,,,Profitability,,,,,,,"Quarterly operating profits-to-lagged equity, Oleq, is quarterly total revenue (Compustat quarterly item REVTQ) minus cost of goods sold (item COGSQ, zero if missing), minus selling, general, and administrative expenses (item XSGAQ, zero if missing), and minus interest expense (item XINTQ, zero if missing), scaled by one-quarter-lagged book equity. We require at least one of the three expense items (COGSQ, XSGAQ, and XINTQ) to be non-missing. Book equity is shareholders' equity, plus balance sheet deferred taxes and investment tax credit (item TXDITCQ) if available, minus the book value of preferred stock (item PSTKQ). Depending on availability, we use stockhold- ers' equity (item SEQQ), or common equity (item CEQQ) plus the book value of preferred stock, or total assets (item ATQ) minus total liabilities (item LTQ) in that order as shareholders' equity.
At the beginning of each month t, we split stocks on Oleq for the fiscal quarter ending at least four months ago. Monthly decile returns are calculated for month t (Oleq 1), from month t to t + 5 (Oleq6), and from month t to t + 11 (Oleq12). The deciles are rebalanced at the beginning of t + 1. The holding period longer than one month as in Oleq6 means that for a given decile in each month there exist six subdeciles, each initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Oleq6 decile. For sufficient data coverage, the Oleq portfolios start in January 1972."
A.4.15,Opa,Operating Proﬁts-to-assets,"Linnainmaa, and Nikolaev",2015,Profitability,,,,,,,"Following Ball, Gerakos, Linnainmaa, and Nikolaev (2015), we measure operating profits-to-assets, Opa, as total revenue (Compustat annual item REVT) minus cost of goods sold (item COGS), minus selling, general, and administrative expenses (item XSGA), and plus research and develop- ment expenditures (item XRD, zero if missing), scaled by book assets (item AT, the denominator is current, not lagged, total assets). At the end of June of each year t, we sort stocks into deciles based on Opa for the fiscal year ending in calendar year t-1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.17,"Ola q 1, Ola q 6, and Ola q 12",Quarterly Operating Proﬁts-to-lagged Assets,,,Profitability,,,,,,,"Quarterly operating profits-to-lagged assets, Olaq, is quarterly total revenue (Compustat quarterly item REVTQ) minus cost of goods sold (item COGSQ), minus selling, general, and administra- tive expenses (item XSGAQ), plus research and development expenditures (item XRDQ, zero if missing), scaled by one-quarter-lagged book assets (item ATQ). At the beginning of each month t, we sort stocks into deciles based on Olaq for the fiscal quarter ending at least four months ago. Monthly decile returns are calculated for month t (Olaq1), from month t to t+5 (Olaq6), and from month t to t + 11 (Olaq12). The deciles are rebalanced at the beginning of t + 1. The holding period longer than one month as in Olaq6 means that for a given decile in each month there exist six subdeciles, each initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Olaq6 decile. For sufficient data coverage, the Olaq portfolios start in January 1976."
A.4.18,Cop,Cash-based Operating Proﬁtability,"Gerakos, Linnainmaa, and Nikolaev",2016,Profitability,"data_rawa['cop'] = data_rawa['revt'] - data_rawa['cogs'] - data_rawa['xsga'] + data_rawa['xrd_0']\
                 - data_rawa['d_rect_0'] - data_rawa['d_invt_0'] - data_rawa['d_xpp_0']\
                 + data_rawa['d_dr_0'] + data_rawa['d_ap_0'] + data_rawa['d_xacc_0']
data_rawa['cop'] = data_rawa['cop'] / data_rawa['at'] ",* Cla,0,1,0,0,"Following Ball, Gerakos, Linnainmaa, and Nikolaev (2016), we measure cash-based operating prof- itability, Cop, as total revenue (Compustat annual item REVT) minus cost of goods sold (item COGS), minus selling, general, and administrative expenses (item XSGA), plus research and de- velopment expenditures (item XRD, zero if missing), minus change in accounts receivable (item RECT), minus change in inventory (item INVT), minus change in prepaid expenses (item XPP), plus change in deferred revenue (item DRC plus item DRLT), plus change in trade accounts payable (item AP), and plus change in accrued expenses (item XACC), all scaled by book assets (item AT, the denominator is current, not lagged, total assets). All changes are annual changes in balance sheet items and we set missing changes to zero. At the end of June of each year t, we sort stocks into deciles based on Cop for the fiscal year ending in calendar year t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.19,Cla,Cash-based Operating Proﬁts-to-lagged Assets,,,Profitability,"data_rawa['cla'] = data_rawa['revt'] - data_rawa['cogs'] - data_rawa['xsga'] + data_rawa['xrd_0']\
                 - data_rawa['d_rect_0'] - data_rawa['d_invt_0'] - data_rawa['d_xpp_0']\
                 + data_rawa['d_dr_0'] + data_rawa['d_ap_0'] + data_rawa['d_xacc_0']
data_rawa['cla'] = data_rawa['cla'] / data_rawa['at'].shift(1)","data_rawa['d_rect'] = data_rawa['rect'] - data_rawa['rect'].shift(1)
data_rawa['d_invt'] = data_rawa['invt'] - data_rawa['invt'].shift(1)
data_rawa['d_xpp'] = data_rawa['xpp'] - data_rawa['xpp'].shift(1)
data_rawa['d_dr'] = (data_rawa['drc']-data_rawa['drc'].shift(1)) + (data_rawa['drlt']-data_rawa['drlt'].shift(1))
data_rawa['d_ap'] = data_rawa['ap'] - data_rawa['ap'].shift(1)
data_rawa['d_xacc'] = data_rawa['xacc'] - data_rawa['xacc'].shift(1)

data_rawa['xrd_0'] = np.where(data_rawa['xrd'].isnull(), 0, data_rawa['xrd'])
data_rawa['d_rect_0'] = np.where(data_rawa['d_rect'].isnull(), 0, data_rawa['d_rect'])
data_rawa['d_invt_0'] = np.where(data_rawa['d_invt'].isnull(), 0, data_rawa['d_invt'])
data_rawa['d_xpp_0'] = np.where(data_rawa['d_xpp'].isnull(), 0, data_rawa['d_xpp'])
data_rawa['d_dr_0'] = np.where(data_rawa['d_dr'].isnull(), 0, data_rawa['d_dr'])
data_rawa['d_ap_0'] = np.where(data_rawa['d_ap'].isnull(), 0, data_rawa['d_ap'])
data_rawa['d_xacc_0'] = np.where(data_rawa['d_xacc'].isnull(), 0, data_rawa['d_xacc'])",0,1,0,0,"Cash-based operating profits-to-lagged assets, Cla, is total revenue (Compustat annual item REVT) minus cost of goods sold (item COGS), minus selling, general, and administrative expenses (item XSGA), plus research and development expenditures (item XRD, zero if missing), minus change in accounts receivable (item RECT), minus change in inventory (item INVT), minus change in prepaid expenses (item XPP), plus change in deferred revenue (item DRC plus item DRLT), plus change in trade accounts payable (item AP), and plus change in accrued expenses (item XACC), all scaled by one-year-lagged book assets (item AT). All changes are annual changes in balance sheet items and we set missing changes to zero. At the end of June of each year t, we sort stocks into deciles based on Cla for the fiscal year ending in calendar year t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.2,"dRoe1, dRoe6, and dRoe12",Changes in Return on Equity,"Hou, Xue, and Zhang",2015,Profitability,,,,,,,"Change in return on equity, dRoe, is return on equity minus its value from four quarters ago. See Appendix A.4.1 for the measurement of return on equity. At the beginning of each month t, we sort all stocks into deciles on their most recent past dRoe. Before 1972, we use the most recent dRoe with quarterly earnings from fiscal quarters ending at least four months ago. Starting from 1972, we use dRoe computed with quarterly earnings from the most recent quarterly earnings announcement dates (Compustat quarterly item RDQ). For a firm to enter the portfolio formation, we require the end of the fiscal quarter that corresponds to its most recent dRoe to be within six months prior to the portfolio formation. This restriction is imposed to exclude stale earnings information. To avoid potentially erroneous records, we also require the earnings announcement date to be after the corresponding fiscal quarter end. Monthly decile returns are calculated for the current month t (dRoe1), from month t to t + 5 (dRoe6), and from month t to t + 11 (dRoe12). The deciles are rebalanced monthly. The holding period that is longer than one month as in, for instance, dRoe6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdeciles returns as the monthly return of the dRoe6 decile."
A.4.20,Claq,Quarterly Cash-based Operating Proﬁts-to-lagged Assets,,,Profitability,,,,,,,"Quarterly cash-based operating profits-to-lagged assets, Cla, is quarterly total revenue (Compustat quarterly item REVTQ) minus cost of goods sold (item COGSQ), minus selling, general, and ad- ministrative expenses (item XSGAQ), plus research and development expenditures (item XRDQ, zero if missing), minus change in accounts receivable (item RECTQ), minus change in inventory (item INVTQ), plus change in deferred revenue (item DRCQ plus item DRLTQ), and plus change in trade accounts payable (item APQ), all scaled by one-quarter-lagged book assets (item ATQ). All changes are quarterly changes in balance sheet items and we set missing changes to zero. At the beginning of each month t, we split stocks on Claq for the fiscal quarter ending at least four months ago. Monthly decile returns are calculated for month t (Claq1), from month t to t + 5 (Claq6), and from month t to t + 11 (Claq12). The deciles are rebalanced at the beginning of t + 1. The holding period longer than one month as in Claq6 means that for a given decile in each month there exist six subdeciles, each initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Claq6 decile. For sufficient data coverage, the Claq portfolios start in January 1976."
A.4.29,Tbi q 12,Quarterly Taxable Income-to-book Income,"Green, Hand, and Zhang",2013,Profitability,,,,,,,"Quarterly taxable income-to-book income, Tbiq, is quarterly pretax income (Compustat quarterly item PIQ) divided by net income (NIQ). At the beginning of each month t, we split stocks into deciles based on Tbiq calculated with accounting data from the fiscal quarter ending at least four months ago. We exclude firms with non-positive pretax income or net income. We calculate monthly decile returns for the current month t (Tbiq1), from month t to t + 5 (Tbiq6), and from month t to t+11 (Tbiq12). The deciles are rebalanced at the beginning of month t+1. The holding period that is longer than one month as in, for instance, Tbiq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdecile returns as the monthly return of the Tbiq6 decile."
A.4.3,Roa1,Return on Assets,"Balakrishnan, Bartov, and Faurel",2010,Profitability,data_rawq['roa'] = data_rawq['ibq']/data_rawq['atq_l1'],data_rawq['atq_l1'] = data_rawq.groupby(['permno'])['atq'].shift(1),1,0,1,0,"Return on assets, Roa, is income before extraordinary items (Compustat quarterly item IBQ) di- vided by one-quarter-lagged total assets (item ATQ). At the beginning of each month t, we sort all stocks into deciles based on Roa computed with quarterly earnings from the most recent earnings announcement dates (item RDQ). For a firm to enter the portfolio formation, we require the end of the fiscal quarter that corresponds to its most recent Roa to be within six months prior to the portfolio formation. This restriction is imposed to exclude stale earnings information. To avoid potentially erroneous records, we also require the earnings announcement date to be after the corre- sponding fiscal quarter end. Monthly decile returns are calculated for month t (Roa1), from month t to t+5 (Roe6), and from month t to t+11 (Roe12). The deciles are rebalanced at the beginning of t + 1. The holding period that is longer than one month as in, for instance, Roa6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdeciles returns as the monthly return of the Roa6 decile. For sufficient data coverage, the Roa portfolios start in January 1972."
A.4.4,"dRoa1, dRoa6",Changes in Return on Assets,"Balakrishnan, Bartov, and Faurel",2010,Profitability,,,,,,,"Change in return on assets, dRoa, is return on assets minus its value from four quarters ago. See Appendix A.4.3 for the measurement of return on assets. At the beginning of each month t, we sort all stocks into deciles based on dRoa computed with quarterly earnings from the most recent earnings announcement dates (Compustat quarterly item RDQ). For a firm to enter the portfo- lio formation, we require the end of the fiscal quarter that corresponds to its most recent dRoa to be within six months prior to the portfolio formation. This restriction is imposed to exclude stale earnings information. To avoid potentially erroneous records, we also require the earnings announcement date to be after the corresponding fiscal quarter end. Monthly decile returns are calculated for month t (dRoa1), from month t to t + 5 (dRoa6), and from month t to t + 11 (dRoa12). The deciles are rebalanced at the beginning of t + 1. The holding period that is longer than one month as in, for instance, dRoa6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdecile returns as the monthly return of the dRoa6 decile. For sufficient data coverage, the dRoa portfolios start in January 1973."
A.4.5,Ato,Asset Turnover,Soliman,2008,Profitability,data_rawq['ato'] = data_rawq['saleq']/data_rawq['noa_l4'],"* noa
* noa_l4 from rna",1,0,1,0,"Soliman (2008) use DuPont analysis to decompose Roe as Rna + FLEV * SPREAD, in which Roe is return on equity, Rna is return on net operating assets, FLEV is financial leverage, and SPREAD is the difference between return on net operating assets and borrowing costs. We can further decompose Rna as Pm * Ato, in which Pm is profit margin and Ato is asset turnover.
Following Soliman (2008), we use annual sorts to form Rna, Pm, and Ato deciles. At the end of June of year t, we measure Rna as operating income after depreciation (Compustat annual item OIADP) for the fiscal year ending in calendar year t - 1 divided by net operating assets (Noa) for the fiscal year ending in t - 2. Noa is operating assets minus operating liabilities. Operating assets are total assets (item AT) minus cash and short-term investment (item CHE), and minus other investment and advances (item IVAO, zero if missing). Operating liabilities are total assets minus debt in current liabilities (item DLC, zero if missing), minus long-term debt (item DLTT, zero if missing), minus minority interests (item MIB, zero if missing), minus preferred stocks (item PSTK, zero if missing), and minus common equity (item CEQ). Pm is operating income after depreciation divided by sales (item SALE) for the fiscal year ending in calendar year t - 1. Ato is sales for the fiscal year ending in calendar year t - 1 divided by Noa for the fiscal year ending in t - 2. At the end of June of each year t, we sort stocks into three sets of deciles based on Rna, Pm, and Ato. We exclude firms with non-positive Noa for the fiscal year ending in calendar year t - 2 when forming the Rna and the Ato portfolios. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.5,pm,proﬁt margin,Soliman,2008,Profitability,,,,,,,"Soliman (2008) use DuPont analysis to decompose Roe as Rna + FLEV * SPREAD, in which Roe is return on equity, Rna is return on net operating assets, FLEV is financial leverage, and SPREAD is the difference between return on net operating assets and borrowing costs. We can further decompose Rna as Pm * Ato, in which Pm is profit margin and Ato is asset turnover.
Following Soliman (2008), we use annual sorts to form Rna, Pm, and Ato deciles. At the end of June of year t, we measure Rna as operating income after depreciation (Compustat annual item OIADP) for the fiscal year ending in calendar year t - 1 divided by net operating assets (Noa) for the fiscal year ending in t - 2. Noa is operating assets minus operating liabilities. Operating assets are total assets (item AT) minus cash and short-term investment (item CHE), and minus other investment and advances (item IVAO, zero if missing). Operating liabilities are total assets minus debt in current liabilities (item DLC, zero if missing), minus long-term debt (item DLTT, zero if missing), minus minority interests (item MIB, zero if missing), minus preferred stocks (item PSTK, zero if missing), and minus common equity (item CEQ). Pm is operating income after depreciation divided by sales (item SALE) for the fiscal year ending in calendar year t - 1. Ato is sales for the fiscal year ending in calendar year t - 1 divided by Noa for the fiscal year ending in t - 2. At the end of June of each year t, we sort stocks into three sets of deciles based on Rna, Pm, and Ato. We exclude firms with non-positive Noa for the fiscal year ending in calendar year t - 2 when forming the Rna and the Ato portfolios. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.6,Cto,Capital Turnover,Haugen and Baker,1996,Profitability,data_rawa['cto'] = data_rawa['sale'] / data_rawa['at'].shift(1),,0,1,0,0,"At the end of June of each year t, we split stocks into deciles based on capital turnover, Cto, measured as sales (Compustat annual item SALE) for the fiscal year ending in calendar year t - 1 divided by total assets (item AT) for the fiscal year ending in t - 2. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.4.7,"Rna q 1, Rna q 6, Atoq1","Quarterly Return on Net Operating Assets, Quarterly Asset Turnover",Soliman,2008,Profitability,data_rawq['rna'] = data_rawq['oiadpq']/data_rawq['noa_l4'],"* noa
data_rawq['noa_l4'] = data_rawq.groupby(['permno'])['noa'].shift(4)",1,0,1,0,"Quarterly return on net operating assets, Rnaq, is quarterly operating income after depreciation (Compustat quarterly item OIADPQ) divided by one-quarter-lagged net operating assets (Noa). Noa is operating assets minus operating liabilities. Operating assets are total assets (item ATQ) minus cash and short-term investments (item CHEQ), and minus other investment and advances (item IVAOQ, zero if missing). Operating liabilities are total assets minus debt in current liabilities (item DLCQ, zero if missing), minus long-term debt (item DLTTQ, zero if missing), minus minority interests (item MIBQ, zero if missing), minus preferred stocks (item PSTKQ, zero if missing), and minus common equity (item CEQQ). Quarterly profit margin, Pmq, is quarterly operating income after depreciation divided by quarterly sales (item SALEQ). Quarterly asset turnover, Atoq, is quarterly sales divided by one-quarter-lagged Noa.
At the beginning of each month t, we sort stocks into deciles based on Rnaq or Pmq for the latest fiscal quarter ending at least four months ago. Separately, we sort stocks into deciles based on Atoq computed with quarterly sales from the most recent earnings announcement dates (item RDQ). Sales are generally announced with earnings during quarterly earnings announcements (Je- gadeesh and Livnat 2006). For a firm to enter the portfolio formation, we require the end of the fiscal quarter that corresponds to its most recent Atoq to be within six months prior to the portfolio formation. This restriction is imposed to exclude stale information. To avoid potentially erroneous records, we also require the earnings announcement date to be after the corresponding fiscal quarter end. Monthly decile returns are calculated for month t (Rnaq1, Pmq1, and Atoq1), from month t to t+5 (Rnaq6, Pmq6, and Atoq6), and from month t to t+11 (Rnaq12, Pmq12, and Atoq12). The deciles are rebalanced at the beginning of t + 1. The holding period that is longer than one month as in, for instance, Atoq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdecile returns as the monthly return of the Atoq6 decile. For sufficient data coverage, the Rnaq portfolios start in January 1976 and the Atoq portfolios start in January 1972.
"
A.4.8,"Cto q1, Cto q6,",Quarterly Capital Turnover,Haugen and Baker,1996,Profitability,,,,,,,"Quarterly capital turnover, Ctoq, is quarterly sales (Compustat quarterly item SALEQ) scaled by one-quarter-lagged total assets (item ATQ). At the beginning of each month t, we sort stocks into deciles based on Ctoq computed with quarterly sales from the most recent earnings announcement dates (item RDQ). Sales are generally announced with earnings during quarterly earnings announce- ments (Jegadeesh and Livnat 2006). For a firm to enter the portfolio formation, we require the end of the fiscal quarter that corresponds to its most recent Atoq to be within six months prior to the portfolio formation. This restriction is imposed to exclude stale information. To avoid potentially erroneous records, we also require the earnings announcement date to be after the corresponding fiscal quarter end. Monthly decile returns are calculated for month t (Ctoq1), from month t to t+5 (Ctoq6), and from month t to t + 11 (Ctoq12). The deciles are rebalanced at the beginning of t + 1. The holding period that is longer than one month as in, for instance, Ctoq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdecile returns as the monthly return of the Ctoq6 decile. For sufficient data coverage, the Ctoq portfolios start in January 1972.
"
A.4.9,Gpa,Gross Proﬁts-to-assets,Novy-Marx,2013,Profitability,,,,,,,"Following Novy-Marx (2013), we measure gross profits-to-assets, Gpa, as total revenue (Compustat annual item REVT) minus cost of goods sold (item COGS) divided by total assets (item AT, the denominator is current, not lagged, total assets). At the end of June of each year t, we sort stocks into deciles based on Gpa for the fiscal year ending in calendar year t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.5.1,Oca and Ioca,(Industry-adjusted) Organizational Capital-to-assets,Eisfeldt and Papanikolaou,2013,Intangibles,,,,,,,p101
A.5.11,Rca,R&D Capital-to-assets,Li,2011,Intangibles,,,,,,,"Following Li (2011), we measure R&D capital, Rc, by accumulating annual R&D expenses over the past five years with a linear depreciation rate of 20%:
Rcit = XRDit + 0.8 XRDit-1 + 0.6 XRDit-2 + 0.4 XRDit-3 + 0.2 XRDit-4, (A18)
in which XRDit-j is firm i's R&D expenses (Compustat annual item XRD) in year t - j. R&D capital-to-assets, Rca, is Rc scaled by total assets (item AT). At the end of June of each year t, we sort stocks into deciles based on Rca for the fiscal year ending in calendar year t - 1. We keep only firms with positive Rc. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1. For portfolio formation at the end of June of year t, we require R&D expenses to be non-missing for the fiscal year ending in calendar year t - 1, because this value of R&D expenses receives the highest weight in Rc. Because Rc requires past five years of R&D expenses data and the accounting treatment of R&D expenses was standardized in 1975, the Rca portfolios start in July 1980."
A.5.2,Adm,Advertising Expense-to-market,"Chan, Lakonishok, and Sougiannis",2001,Intangibles,data_rawa['adm'] = data_rawa['xad']/data_rawa['me'],* me from rawa,1,1,0,0,"At the end of June of each year t, we sort stocks into deciles based on advertising expenses-to- market, Adm, which is advertising expenses (Compustat annual item XAD) for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Adm. We keep only firms with positive advertising expenses. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1. Because sufficient XAD data start in 1972, the Adm portfolios start in July 1973."
A.5.24,Etr,Eﬀective Tax Rate,Abarbanell and Bushee,1998,Intangibles,data_rawa['etr'] = (data_rawa['txtpi'] - (data_rawa['txtpi_l1'] + data_rawa['txtpi_l2'] + data_rawa['txtpi_l3'])/3) * data_rawa['deps'],"data_rawa['txtpi'] = data_rawa['txt'] / data_rawa['pi']
data_rawa['txtpi_l1'] = data_rawa.groupby('permno')['txtpi'].shift(1)
data_rawa['txtpi_l2'] = data_rawa.groupby('permno')['txtpi'].shift(2)
data_rawa['txtpi_l3'] = data_rawa.groupby('permno')['txtpi'].shift(3)
data_rawa['deps'] = data_rawa['epspx']/(data_rawa['ajex'] * data_rawa['prcc_f'])",0,1,0,0,p108
A.5.4,Rdm,R&D Expense-to-market,"Chan, Lakonishok, and Sougiannis",2001,Intangibles,data_rawq['rdm'] = data_rawq['xrdq4']/data_rawq['me'],"* me from rawq
# rd
data_rawq['xrdq4'] = ttm4('xrdq', data_rawq)
data_rawq['xrdq4'] = np.where(data_rawq['xrdq4'].isnull(), data_rawq['xrdy'], data_rawq['xrdq4'])",1,0,1,0,"At the end of June of each year t, we sort stocks into deciles based on R&D-to-market, Rdm, which is R&D expenses (Compustat annual item XRD) for the fiscal year ending in calendar year t - 1 divided by the market equity (from CRSP) at the end of December of t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Rdm. We keep only firms with positive R&D expenses. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1. Because the accounting treatment of R&D expenses was standardized in 1975, the Rdm portfolios start in July 1976."
A.5.46,"Alm q 1, Alm q 6, and Alm q 12",Quarterly Asset Liquidity,Ortiz-Molina and Phillips,2014,Intangibles,data_rawq['alm'] = data_rawq['ala']/(data_rawq['atq']+data_rawq['me']-data_rawq['ceqq']),"data_rawq['ala'] = data_rawq['cheq'] + 0.75*(data_rawq['actq']-data_rawq['cheq'])+\
                 0.5*(data_rawq['atq']-data_rawq['actq']-data_rawq['gdwlq']-data_rawq['intanq'])
* me from rawq",1,0,1,0,"We measure quarterly asset liquidity as cash + 0.75 * noncash current assets + 0.50 * tangible fixed assets. Cash is cash and short-term investments (Compustat quarterly item CHEQ). Noncash current assets is current assets (item ACTQ) minus cash. Tangible fixed assets is total assets (item ATQ) minus current assets (item ACTQ), minus goodwill (item GDWLQ, zero if missing), and minus intangibles (item INTANQ, zero if missing). Alaq is quarterly asset liquidity scaled by one- quarter-lagged total assets. Almq is quarterly asset liquidity scaled by one-quarter-lagged market value of assets. Market value of assets is total assets plus market equity (item PRCCQ times item CSHOQ) minus book equity (item CEQQ).
At the beginning of each month t, we sort stocks into deciles based on Alaq, and separately, on Almq for the fiscal quarter ending at least four months ago. Monthly decile returns are calculated for the current month t (Alaq1 and Almq1), from month t to t + 5 (Alaq6 and Almq6), and from month t to t+11 (Alaq12 and Almq12). The deciles are rebalanced at the beginning of month t+1. The holding period longer than one month as in Alaq6 means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Alaq6 decile. For sufficient data coverage, the quarterly asset liquidity portfolios start in January 1976.
"
A.5.5,"Rdm q 1, Rdm q 6, and Rdm q 12",Quarterly R&D Expense-to-market,"Chan, Lakonishok, and Sougiannis",2001,Intangibles,,,,,,,"At the beginning of each month t, we split stocks into deciles based on quarterly R&D-to-market, Rdmq, which is quarterly R&D expense (Compustat quarterly item XRDQ) for the fiscal quarter ending at least four months ago scaled by the market equity (from CRSP) at the end of t - 1. For firms with more than one share class, we merge the market equity for all share classes before computing Rdmq. We keep only firms with positive R&D expenses. We calculate decile returns for the current month t (Rdmq1), from month t to t + 5 (Rdmq6), and from month t to t + 11 (Rdmq12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in, for instance, Rdmq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Rdmq6 decile. Because the quarterly R&D data start in late 1989, the Rdmq portfolios start in January 1990."
A.5.50,"R a 1 , R n 1 , R a [2,5] , R n[2,5] , R a[6,10] , R n[6,10] , R a[11,15] , and R a[16,20]",Seasonality,Heston and Sadka,2008,Intangibles,,"* crsp_mom
#Rla
crsp_mom['rla'] = crsp_mom.groupby(['permno'])['ret'].shift(12)

#Rln
lag = pd.DataFrame()
result = 0
for i in range(1, 12):
    lag['mom%s' % i] = crsp_mom.groupby(['permno'])['ret'].shift(i)
    result = result + lag['mom%s' % i]
crsp_mom['rln'] = result/11

#R[2,5]a
#R[2,5]n
lag = pd.DataFrame()
result = 0
for i in range(13,61):
    lag['mom%s' % i] = crsp_mom.groupby(['permno'])['ret'].shift(i)
    if i not in [24,36,48,60]:
        result = result + lag['mom%s' % i]

crsp_mom['r25a'] = (lag['mom24']+lag['mom36']+lag['mom48']+lag['mom60'])/4
crsp_mom['r25n'] = result/44

#R[6,10]a
#R[6,10]n
lag = pd.DataFrame()
result = 0
for i in range(61,121):
    lag['mom%s' % i] = crsp_mom.groupby(['permno'])['ret'].shift(i)
    if i not in [72,84,96,108,120]:
        result = result + lag['mom%s' % i]

crsp_mom['r610a'] = (lag['mom72']+lag['mom84']+lag['mom96']+lag['mom108']+lag['mom120'])/5
crsp_mom['r610n'] = result/55

#R[11,15]a
lag = pd.DataFrame()
result = 0
for i in [132,144,156,168,180]:
    lag['mom%s' % i] = crsp_mom.groupby(['permno'])['ret'].shift(i)
    result = result + lag['mom%s' % i]
crsp_mom['r1115a'] = result/5

#R[16,20]a
lag = pd.DataFrame()
result = 0
for i in [192,204,216,228,240]:
    lag['mom%s' % i] = crsp_mom.groupby(['permno'])['ret'].shift(i)
    result = result + lag['mom%s' % i]
crsp_mom['r1620a'] = result/5",1,0,0,0,"Following Heston and Sadka (2008), at the beginning of each month t, we sort stocks into deciles
based on various measures of past performance, including returns in month t - 12 (Ra1), average
returns from month t - 11 to t - 1 (Rn1), average returns across months t - 24,t - 36,t - 48, and
t - 60 (R[2,5]), average returns from month t - 60 to t - 13 except for lags 24, 36, 48, and 60 (R[2,5]), an
average returns across months t - 72, t - 84, t - 96, t - 108, and t - 120 (R[6,10]), average returns a
from month t - 120 to t - 61 except for lags 72, 84, 96, 108, and 120 (R[6,10]), average returns across n
months t - 132, t - 144, t - 156, t - 168, and t - 180 (R[11,15]), average returns from month t - 180 a
to t - 121 except for lags 132, 144, 156, 168, and 180 (R[11,15]), average returns across months n
t-192,t-204,t-216,t-228, and t-240 (R[16,20]), average returns from month t-240 to t-181 a
except for lags 192, 204, 216, 228, and 240 (R[16,20]). Monthly decile returns are calculated for the n
current month t, and the deciles are rebalanced at the beginning of month t + 1."
A.5.6,Rds q 6 and Rds q 12,Quarterly R&D Expense-to-sales,"Chan, Lakonishok, and Sougiannis",2001,Intangibles,data_rawq['rds'] = data_rawq['xrdq4']/data_rawq['saleq'],* xrdq4 from rdm,0,0,1,0,"At the end of June of each year t, we sort stocks into deciles based on R&D-to-sales, Rds, which is R&D expenses (Compustat annual item XRD) divided by sales (item SALE) for the fiscal year ending in calendar year t - 1. We keep only firms with positive R&D expenses. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1. Because the accounting treatment of R&D expenses was standardized in 1975, the Rds portfolios start in July 1976."
A.5.8,Ol,Operating Leverage,Novy-Marx,2011,Intangibles,data_rawa['ol'] = (data_rawa['cogs'] + data_rawa['xsga'])/data_rawa['at'],,0,1,0,0,"Following Novy-Marx (2011), operating leverage, Ol, is operating costs scaled by total assets (Com- pustat annual item AT, the denominator is current, not lagged, total assets). Operating costs are cost of goods sold (item COGS) plus selling, general, and administrative expenses (item XSGA). At the end of June of year t, we sort stocks into deciles based on Ol for the fiscal year ending in calendar year t - 1. Monthly decile returns are calculated from July of year t to June of t + 1, and the deciles are rebalanced in June of t + 1."
A.5.9,"Ol q 1, Ol q 6, and Ol q 12",Quarterly Operating Leverage,Novy-Marx,2011,Intangibles,data_rawq['olq'] = (data_rawq['cogsq'] + data_rawq['xsgaq'])/data_rawq['atq'],,0,0,1,0,"At the beginning of each month t, we split stocks into deciles based on quarterly operating leverage, Olq, which is quarterly operating costs divided by assets (Compustat quarterly item ATQ) for the fiscal quarter ending at least four months ago. Operating costs are the cost of goods sold (item COGSQ) plus selling, general, and administrative expenses (item XSGAQ). We calculate decile returns for the current month t (Olq1), from month t to t + 5 (Olq6), and from month t to t + 11 (Olq12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in, for instance, Olq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Olq6 decile. For sufficient data coverage, the Olq portfolios start in January 1972."
A.6.1,Me,the market equity,Banz,1981,Frictions,"# rawq['me']
crsp['me'] = crsp['prc'].abs() * crsp['shrout']  # calculate market equity 
crsp['me'] = np.where(crsp['permno'] == crsp['permno'].shift(1), crsp['me'].fillna(method='ffill'), crsp['me'])
data_rawq['me'] = data_rawq['me']/1000  # CRSP ME
data_rawq['me'] = np.where(data_rawq['me'] == 0, np.nan, data_rawq['me'])
data_rawq = data_rawq.dropna(subset=['me'])","#rawa['me']
crsp['me'] = crsp['prc'].abs() * crsp['shrout']  # calculate market equity 
crsp['me'] = np.where(crsp['permno'] == crsp['permno'].shift(1), crsp['me'].fillna(method='ffill'), crsp['me'])
data_rawa['me'] = data_rawa['me']/1000  # CRSP ME
# there are some ME equal to zero since this company do not have price or shares data, we drop these observations
data_rawa['me'] = np.where(data_rawa['me'] == 0, np.nan, data_rawa['me'])
data_rawa = data_rawa.dropna(subset=['me'])
# rawq['me']
crsp['me'] = crsp['prc'].abs() * crsp['shrout']  # calculate market equity 
crsp['me'] = np.where(crsp['permno'] == crsp['permno'].shift(1), crsp['me'].fillna(method='ffill'), crsp['me'])
data_rawq['me'] = data_rawq['me']/1000  # CRSP ME
# there are some ME equal to zero since this company do not have price or shares data, we drop these observations
data_rawq['me'] = np.where(data_rawq['me'] == 0, np.nan, data_rawq['me'])
data_rawq = data_rawq.dropna(subset=['me'])",1,1,1,0,"Market equity, Me, is price times shares outstanding from CRSP. At the end of June of each year t, we sort stocks into deciles based on the June-end Me. Monthly decile returns are calculated from July of year t to June of t+1, and the deciles are rebalanced in June of t+1."
A.6.13,Dtv12,"dollar trading volume, 12-month holding period","Brennan, Chordia, and Subrahmanyam",1998,Frictions,,,,,,,"At the beginning of each month t, we sort stocks into deciles based on their average daily dollar trading volume, Dtv, over the prior six months from t-6 to t-1. We require a minimum of 50 daily observations. Dollar trading volume is share price times the number of shares traded. We adjust the trading volume of NASDAQ stocks per Gao and Ritter (2010) (see footnote 7). Monthly decile returns are calculated for the current month t (Dtv1), from month t to t+5 (Dtv6), and from month t to t + 11 (Dtv12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in, for instance, Dtv6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Dtv6 decile."
A.6.21,Isff1,"idiosyncratic skewness estimated from the Fama-French 3-factor model, 1-month holding period",Harvey and Siddique,2000,Frictions,,,,,,,"At the beginning of each month t, we sort stocks into deciles based on idiosyncratic skewness, Isff, calculated as the skewness of the residuals from regressing a stock's excess return on the Fama- French three factors using daily observations from month t - 1. We require a minimum of 15 daily returns. Monthly decile returns are calculated for the current month t (Isff1), from month t to t + 5 (Isff6), and from month t to t + 11 (Isff12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in Isff6 means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Isff6 decile."
A.6.22,Isq1,"idiosyncratic skewness estimated from the q-factor model, 1-month holding period",Harvey and Siddique,2000,Frictions,,,,,,,"At the beginning of each month t, we sort stocks into deciles based on idiosyncratic skewness, Isq, calculated as the skewness of the residuals from regressing a stock's excess return on the q-factors using daily observations from month t - 1. We require a minimum of 15 daily returns. Monthly decile returns are calculated for the current month t (Isq1), from month t to t + 5 (Isq6), and from month t to t + 11 (Isq12), and the deciles are rebalanced at the beginning of month t + 1. The holding period longer than one month as in Isq6 means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six months. We take the simple average of the subdecile returns as the monthly return of the Isq6 decile. Because the q-factors start in January 1967, the Ivq portfolios start in February 1967."
A.6.24,Srev,short-term reversal,Jegadeesh,1990,Frictions,,,,,,,"At the beginning of each month t, we sort stocks into short-term reversal (Srev) deciles based on the return in month t - 1. To be included in a decile in month t, a stock must have a valid price at the end of month t - 2 and a valid return for month t - 1. Monthly decile returns are calculated for the current month t, and the deciles are rebalanced at the beginning of month t + 1."
A.6.3,Ivff1,"idiosyncratic volatility estimated from the Fama-French 3-factor model, 1-month holding period","Ang, Hodrick, Xing, and Zhang",2006,Frictions,,,,,,,"Following Ang, Hodrick, Xing, and Zhang (2006), we calculate idiosyncratic volatility relative to the Fama-French three-factor model, Ivff, as the residual volatility from regressing a stock's excess returns on the Fama-French three factors. At the beginning of each month t, we sort stocks into deciles based on the Ivff estimated with daily returns from month t - 1. We require a minimum of 15 daily returns. Monthly decile returns are calculated for the current month t (Ivff1), from month t to t+5 (Ivff6), and from month t to t+11 (Ivff12), and the deciles are rebalanced at the beginning of month t + 1. The holding period that is longer than one month as in, for instance, Ivff6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdecile returns as the monthly return of the Ivff6 decile."
A.6.5,Ivq1,"idiosyncratic volatility estimated from the q-factor model, 1-month holding period","Ang, Hodrick, Xing, and Zhang",2006,Frictions,,,,,,,"We calculate idiosyncratic volatility per the q-factor model, Ivq, as the residual volatility from regressing a stock's excess returns on the q-factors. At the beginning of each month t, we sort stocks into deciles based on the Ivq estimated with daily returns from month t - 1. We require a minimum of 15 daily returns. Monthly decile returns are calculated for the current month t (Ivq1), from month t to t + 5 (Ivq6), and from month t to t + 11 (Ivq12), and the deciles are rebalanced at the beginning of month t + 1. The holding period that is longer than one month as in, for instance, Ivq6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdecile returns as the monthly return of the Ivq6 decile. Because the q-factors start in January 1967, the Ivq portfolios start in February 1967."
A.6.6,Tv1,"total volatility, 1-month holding period","Ang, Hodrick, Xing, and Zhang",2006,Frictions,,,,,,,"Following Ang, Hodrick, Xing, and Zhang (2006), at the beginning of each month t, we sort stocks into deciles based on total volatility, Tv, estimated as the volatility of a stock's daily returns from month t - 1. We require a minimum of 15 daily returns. Monthly decile returns are calculated for the current month t, (Tv1), from month t to t + 5 (Tv6), and from month t to t + 11 (Tv12), and the deciles are rebalanced at the beginning of month t + 1. The holding period that is longer than one month as in, for instance, Tv6, means that for a given decile in each month there exist six subdeciles, each of which is initiated in a different month in the prior six-month period. We take the simple average of the subdeciles returns as the monthly return of the Tv6 decile."
A.6.7,Sv1,"systematic volatility, 1-month holding period","Ang, Hodrick, Xing, and Zhang",2006,Frictions,,,,,,,p119
A.6.8,Beta1,Market Beta,Fama and MacBeth,1973,Frictions,,,,,,,p119
,agr,Asset growth,"Cooper, Gulen & Schill",2008,,data_rawq['agr'] = (data_rawq['atq']-data_rawq['atq_l4'])/data_rawq['atq_l4'],data_rawq['atq_l4'] = data_rawq.groupby(['permno'])['atq'].shift(4),1,0,1,0,Annual percent change in total assets (at).
,baspread,Bid-ask spread rolling 3m,Amihud & Mendelson,1989,,,,,,,,Monthly average of daily bid-ask spread divided by average of daily spread.
,beta,Beta rolling 3m,Fama & MacBeth,1973,,,,,,,,Estimated market beta from weekly returns and equal weighted market returns for 3 years ending month t-1 with at least 52 weeks of returns.
,bm_ia,Industry-adjusted book to market,"Asness, Porter & Stevens",2000,,data_rawa['bm_ia'] = data_rawa['bm']/data_rawa['bm_ind'],"df_temp = data_rawa.groupby(['datadate', 'ffi49'], as_index=False)['bm'].mean()
df_temp = df_temp.rename(columns={'bm': 'bm_ind'})
data_rawa = pd.merge(data_rawa, df_temp, how='left', on=['datadate', 'ffi49'])",0,1,0,0,Industry adjusted book-to-market ratio.
,cash,Cash holdings,Palazzo,2012,,data_rawq['cash'] = data_rawq['cheq']/data_rawq['atq'],,0,0,1,0,Cash and cash equivalents divided by average total assets.
,cashdebt,Cash ﬂow to debt,Ou & Penman,1989,,"data_rawq['cashdebt'] = (ttm4('ibq', data_rawq) + ttm4('dpq', data_rawq))/((data_rawq['ltq']+data_rawq['ltq_l4'])/2)",data_rawq['ltq_l4'] = data_rawq.groupby(['permno'])['ltq'].shift(4),1,0,1,0,Earnings before depreciation and extraordinary items (ib+dp) divided by avg. total liabilities (lt).
,chcsho,Change in shares outstanding,Pontiff & Woodgate,2008,,data_rawq['chcsho'] = (data_rawq['cshoq']/data_rawq['cshoq_l4'])-1,data_rawq['cshoq_l4'] = data_rawq.groupby(['permno'])['cshoq'].shift(4),1,0,1,0,Annual percent change in shares outstanding (csho).
,chpm(chpmia),Industry-adjusted change in proﬁt margin,Soliman,2008,,data_rawq['chpm'] = (data_rawq['ibq4']/data_rawq['saleq4'])-(data_rawq['ibq4_l1']/data_rawq['saleq4_l1']),"data_rawq['ibq4'] = ttm4('ibq', data_rawq)
data_rawq['saleq4'] = ttm4('saleq', data_rawq)
data_rawq['saleq4'] = np.where(data_rawq['saleq4'].isnull(), data_rawq['saley'], data_rawq['saleq4'])
data_rawq['ibq4_l1'] = data_rawq.groupby(['permno'])['ibq4'].shift(1)
data_rawq['saleq4_l1'] = data_rawq.groupby(['permno'])['saleq4'].shift(1)",1,0,1,0,2-digit SIC - fiscal-year mean adjusted change in income before extraordinary items (ib) divided by sales (sale).
,chtx,Change in tax expense,Thomas & Zhang,2011,,data_rawq['chtx'] = (data_rawq['txtq']-data_rawq['txtq_l4'])/data_rawq['atq_l4'],"data_rawq['txtq_l4'] = data_rawq.groupby(['permno'])['txtq'].shift(4)
data_rawq['atq_l4'] = data_rawq.groupby(['permno'])['atq'].shift(4)",1,0,1,0,Percent change in total taxes (txtq) from quarter t-4 to t.
,cinvest,Corporate investment,"Titman, Wei & Xie",2004,,"* data_rawq['cinvest'] = ((data_rawq['ppentq'] - data_rawq['ppentq_l1']) / data_rawq['saleq'])\
                       -(data_rawq[['c_temp1', 'c_temp2', 'c_temp3']].mean(axis=1))","data_rawq['ppentq_l1'] = data_rawq.groupby(['permno'])['ppentq'].shift(1)
data_rawq['ppentq_l2'] = data_rawq.groupby(['permno'])['ppentq'].shift(2)
data_rawq['ppentq_l3'] = data_rawq.groupby(['permno'])['ppentq'].shift(3)
data_rawq['ppentq_l4'] = data_rawq.groupby(['permno'])['ppentq'].shift(4)
data_rawq['saleq_l1'] = data_rawq.groupby(['permno'])['saleq'].shift(1)
data_rawq['saleq_l2'] = data_rawq.groupby(['permno'])['saleq'].shift(2)
data_rawq['saleq_l3'] = data_rawq.groupby(['permno'])['saleq'].shift(3)

data_rawq['c_temp1'] = (data_rawq['ppentq_l1'] - data_rawq['ppentq_l2']) / data_rawq['saleq_l1']
data_rawq['c_temp2'] = (data_rawq['ppentq_l2'] - data_rawq['ppentq_l3']) / data_rawq['saleq_l2']
data_rawq['c_temp3'] = (data_rawq['ppentq_l3'] - data_rawq['ppentq_l4']) / data_rawq['saleq_l3']

* main formula

data_rawq['c_temp1'] = (data_rawq['ppentq_l1'] - data_rawq['ppentq_l2']) / 0.01
data_rawq['c_temp2'] = (data_rawq['ppentq_l2'] - data_rawq['ppentq_l3']) / 0.01
data_rawq['c_temp3'] = (data_rawq['ppentq_l3'] - data_rawq['ppentq_l4']) / 0.01

data_rawq['cinvest'] = np.where(data_rawq['saleq']<=0, ((data_rawq['ppentq'] - data_rawq['ppentq_l1']) / 0.01)
                                -(data_rawq[['c_temp1', 'c_temp2', 'c_temp3']].mean(axis=1)), data_rawq['cinvest'])

data_rawq = data_rawq.drop(['c_temp1', 'c_temp2', 'c_temp3'], axis=1)",1,0,1,0,"Change over one quarter in net PP&E (ppentq) divided by sales (saleq) - average of this variable for prior 3 quarters; if saleq = 0, then scale by 0.01."
,depr,Depreciation / PP&E,Holthausen & Larcker,1992,,"data_rawq['depr'] = ttm4('dpq', data_rawq)/data_rawq['ppentq']",,0,0,1,0,Depreciation divided by PP&E.
,dolvol,Dollar trading volume,"Chordia, Subrahmanyam & Anshuman",2001,,"crsp_mom['dolvol'] = np.log(crsp_mom['vol_l2']*crsp_mom['prc_l2']).replace([np.inf, -np.inf], np.nan)",,1,0,0,0,Natural log of trading volume times price per share from month t-2.
,gma,Gross profitability,Novy-Marx,2013,,data_rawq['gma'] = (data_rawq['revtq4']-data_rawq['cogsq4'])/data_rawq['atq_l4'],"data_rawq['revtq4'] = ttm4('revtq', data_rawq)
data_rawq['cogsq4'] = ttm4('cogsq', data_rawq)
data_rawq['atq_l4'] = data_rawq.groupby(['permno'])['atq'].shift(4)",1,0,1,0,Revenues (revt) minus cost of goods sold (cogs) divided by lagged total assets (at).
,grltnoa,Growth in long-term net operating assets,"Fairfield, Whisenant & Yohn",2003,,"data_rawq['grltnoa'] = ((data_rawq['rectq']+data_rawq['invtq']+data_rawq['ppentq']+data_rawq['acoq']+data_rawq['intanq']+
                       data_rawq['aoq']-data_rawq['apq']-data_rawq['lcoq']-data_rawq['loq'])-
                      (data_rawq['rectq_l4']+data_rawq['invtq_l4']+data_rawq['ppentq_l4']+data_rawq['acoq_l4']-data_rawq['apq_l4']-data_rawq['lcoq_l4']-data_rawq['loq_l4'])-\
                     (data_rawq['rectq']-data_rawq['rectq_l4']+data_rawq['invtq']-data_rawq['invtq_l4']+data_rawq['acoq']-
                      (data_rawq['apq']-data_rawq['apq_l4']+data_rawq['lcoq']-data_rawq['lcoq_l4'])-
                      ttm4('dpq', data_rawq)))/((data_rawq['atq']+data_rawq['atq_l4'])/2)","data_rawq['rectq_l4'] = data_rawq.groupby(['permno'])['rectq'].shift(4)
data_rawq['acoq_l4'] = data_rawq.groupby(['permno'])['acoq'].shift(4)
data_rawq['apq_l4'] = data_rawq.groupby(['permno'])['apq'].shift(4)
data_rawq['lcoq_l4'] = data_rawq.groupby(['permno'])['lcoq'].shift(4)
data_rawq['loq_l4'] = data_rawq.groupby(['permno'])['loq'].shift(4)
data_rawq['invtq_l4'] = data_rawq.groupby(['permno'])['invtq'].shift(4)
data_rawq['ppentq_l4'] = data_rawq.groupby(['permno'])['ppentq'].shift(4)
data_rawq['atq_l4'] = data_rawq.groupby(['permno'])['atq'].shift(4)",1,0,1,0,Growth in long term net operating assets.
,herf,Industry sales concentration,Hou & Robinson,2006,,data_rawa['herf'] = (data_rawa['sale']/data_rawa['indsale'])*(data_rawa['sale']/data_rawa['indsale']),"data_rawa['sic'] = data_rawa['sic'].astype(int)
data_rawa['ffi49'] = ffi49(data_rawa)
data_rawa['ffi49'] = data_rawa['ffi49'].fillna(49)
data_rawa['ffi49'] = data_rawa['ffi49'].astype(int)
df_temp = data_rawa.groupby(['datadate', 'ffi49'], as_index=False)['sale'].sum()
df_temp = df_temp.rename(columns={'sale': 'indsale'})
data_rawa = pd.merge(data_rawa, df_temp, how='left', on=['datadate', 'ffi49'])
* main formula
df_temp = data_rawa.groupby(['datadate', 'ffi49'], as_index=False)['herf'].sum()
data_rawa = data_rawa.drop(['herf'], axis=1)
data_rawa = pd.merge(data_rawa, df_temp, how='left', on=['datadate', 'ffi49'])",0,1,0,0,2-digit SIC - fiscal-year sales concentration (sum of squared percent of sales in industry for each company).
,hire,Employee growth rate,"Bazdresch, Belo & Lin",2014,,"data_rawa['hire'] = (data_rawa['emp'] - data_rawa['emp_l1'])/data_rawa['emp_l1']
data_rawa['hire'] = np.where((data_rawa['emp'].isnull()) | (data_rawa['emp_l1'].isnull()), 0, data_rawa['hire'])",data_rawa['emp_l1'] = data_rawa.groupby(['permno'])['emp'].shift(1),1,1,0,0,Percent change in number of employees (emp).
,ill,Illiquidity rolling 3m,Amihud,2002,,,,,,,,Average of daily (absolute return / dollar volume).
,lev,Leverage,Bhandari,1988,,data_rawq['lev'] = data_rawq['ltq']/data_rawq['me'],* me from rawq,0,0,1,0,Total liabilities (lt) divided by fiscal year end market capitalization.
,lgr,Growth in long-term debt,"Richardson, Sloan, Soliman & Tuna",2005,,data_rawq['lgr'] = (data_rawq['ltq']/data_rawq['ltq_l4'])-1,data_rawq['ltq_l4'] = data_rawq.groupby(['permno'])['ltq'].shift(4),1,0,1,0,Annual percent change in total liabilities (lt).
,maxret,Maximum daily returns rolling 3m,"Bali, Cakici & Whitelaw",2011,,,,,,,,Maximum daily return from returns during calendar month t-1.
,me_ia(mve_ia),Industry-adjusted size,"Asness, Porter & Stevens",2000,,data_rawa['me_ia'] = data_rawa['me']/data_rawa['me_ind'],"* me from rawa
df_temp = data_rawa.groupby(['datadate', 'ffi49'], as_index=False)['me'].mean()
df_temp = df_temp.rename(columns={'me': 'me_ind'})
data_rawa = pd.merge(data_rawa, df_temp, how='left', on=['datadate', 'ffi49'])",1,1,0,0,2-digit SIC industry-adjusted fiscal year-end market capitalization.
,mom12m,Momentum rolling 12m,Jegadeesh,1990,,"crsp_mom['mom12m'] = mom(1, 12, crsp_mom)",* crsp_mom,1,0,0,0,11-month cumulative returns ending one month before month end.
,mom1m,Momentum ,Jegadeesh & Titman,1993,,crsp_mom['mom1m'] = crsp_mom['ret'],* crsp_mom,1,0,0,0,1-month cumulative return.
,mom36m,Momentum rolling 36m,Jegadeesh & Titman,1993,,"crsp_mom['mom36m'] = mom(1, 36, crsp_mom)",* crsp_mom,1,0,0,0,Cumulative returns from months t-36 to t-13.
,mom60m,Momentum rolling 60m,Jegadeesh & Titman,1993,,"crsp_mom['mom60m'] = mom(12, 60, crsp_mom)",* crsp_mom,1,0,0,0,
,mom6m,Momentum rolling 6m,Jegadeesh & Titman,1993,,"crsp_mom['mom6m'] = mom(1, 6, crsp_mom)",* crsp_mom,1,0,0,0,5-month cumulative returns ending one month before month end.
,nincr,Number of earnings increases,"Barth, Elliott & Finn",1999,,"data_rawq['nincr'] = (data_rawq['nincr_temp1']
                      + (data_rawq['nincr_temp1']*data_rawq['nincr_temp2'])
                      + (data_rawq['nincr_temp1']*data_rawq['nincr_temp2']*data_rawq['nincr_temp3'])
                      + (data_rawq['nincr_temp1']*data_rawq['nincr_temp2']*data_rawq['nincr_temp3']*data_rawq['nincr_temp4'])
                      + (data_rawq['nincr_temp1']*data_rawq['nincr_temp2']*data_rawq['nincr_temp3']*data_rawq['nincr_temp4']*data_rawq['nincr_temp5'])
                      + (data_rawq['nincr_temp1']*data_rawq['nincr_temp2']*data_rawq['nincr_temp3']*data_rawq['nincr_temp4']*data_rawq['nincr_temp5']*data_rawq['nincr_temp6'])
                      + (data_rawq['nincr_temp1']*data_rawq['nincr_temp2']*data_rawq['nincr_temp3']*data_rawq['nincr_temp4']*data_rawq['nincr_temp5']*data_rawq['nincr_temp6']*data_rawq['nincr_temp7'])
                      + (data_rawq['nincr_temp1']*data_rawq['nincr_temp2']*data_rawq['nincr_temp3']*data_rawq['nincr_temp4']*data_rawq['nincr_temp5']*data_rawq['nincr_temp6']*data_rawq['nincr_temp7']*data_rawq['nincr_temp8']))","data_rawq['ibq_l1'] = data_rawq.groupby(['permno'])['ibq'].shift(1)
data_rawq['ibq_l2'] = data_rawq.groupby(['permno'])['ibq'].shift(2)
data_rawq['ibq_l3'] = data_rawq.groupby(['permno'])['ibq'].shift(3)
data_rawq['ibq_l4'] = data_rawq.groupby(['permno'])['ibq'].shift(4)
data_rawq['ibq_l5'] = data_rawq.groupby(['permno'])['ibq'].shift(5)
data_rawq['ibq_l6'] = data_rawq.groupby(['permno'])['ibq'].shift(6)
data_rawq['ibq_l7'] = data_rawq.groupby(['permno'])['ibq'].shift(7)
data_rawq['ibq_l8'] = data_rawq.groupby(['permno'])['ibq'].shift(8)

data_rawq['nincr_temp1'] = np.where(data_rawq['ibq'] > data_rawq['ibq_l1'], 1, 0)
data_rawq['nincr_temp2'] = np.where(data_rawq['ibq_l1'] > data_rawq['ibq_l2'], 1, 0)
data_rawq['nincr_temp3'] = np.where(data_rawq['ibq_l2'] > data_rawq['ibq_l3'], 1, 0)
data_rawq['nincr_temp4'] = np.where(data_rawq['ibq_l3'] > data_rawq['ibq_l4'], 1, 0)
data_rawq['nincr_temp5'] = np.where(data_rawq['ibq_l4'] > data_rawq['ibq_l5'], 1, 0)
data_rawq['nincr_temp6'] = np.where(data_rawq['ibq_l5'] > data_rawq['ibq_l6'], 1, 0)
data_rawq['nincr_temp7'] = np.where(data_rawq['ibq_l6'] > data_rawq['ibq_l7'], 1, 0)
data_rawq['nincr_temp8'] = np.where(data_rawq['ibq_l7'] > data_rawq['ibq_l8'], 1, 0)

*main formula

data_rawq = data_rawq.drop(['ibq_l1', 'ibq_l2', 'ibq_l3', 'ibq_l4', 'ibq_l5', 'ibq_l6', 'ibq_l7', 'ibq_l8', 'nincr_temp1',
                            'nincr_temp2', 'nincr_temp3', 'nincr_temp4', 'nincr_temp5', 'nincr_temp6', 'nincr_temp7',
                            'nincr_temp8'], axis=1)",1,0,1,0,Number of consecutive quarters (up to eight quarters) with an increase in earnings (ibq) over same quarter in the prior year.
,op(operprof),Operating proﬁtability,Fama and French,2015,,,,,,,,
,pscore(ps),Performance Score,Piotroski,2000,,"data_rawa['ps'] = np.where(data_rawa['pstkrv'].isnull(), data_rawa['pstkl'], data_rawa['pstkrv'])
data_rawa['ps'] = np.where(data_rawa['ps'].isnull(), data_rawa['pstk'], data_rawa['ps'])
data_rawa['ps'] = np.where(data_rawa['ps'].isnull(), 0, data_rawa['ps'])",#(pstkrv prior to pstkl prior to pstk),0,1,0,0,Sum of 9 indicator variables to form fundamental health score.
,rd_sale,R&D to sales,"Guo, Lev & Shi",2006,,data_rawq['rd_sale'] = data_rawq['xrdq4']/data_rawq['saleq4'],"data_rawq['xrdq4'] = ttm4('xrdq', data_rawq)
data_rawq['xrdq4'] = np.where(data_rawq['xrdq4'].isnull(), data_rawq['xrdy'], data_rawq['xrdq4'])
data_rawq['saleq4'] = ttm4('saleq', data_rawq)
data_rawq['saleq4'] = np.where(data_rawq['saleq4'].isnull(), data_rawq['saley'], data_rawq['saleq4'])",0,0,1,0,R&D expense divided by sales (xrd/sale).
,re,Revisions in analysts’ earnings forecasts,"Chan, Jegadeesh, and Lakonishok",1996,,,,,,,,
,rsup,Revenue surprise,Kama,2009,,data_rawq['rsup'] = (data_rawq['saleq'] - data_rawq['saleq_l4'])/data_rawq['me'],data_rawq['saleq_l4'] = data_rawq.groupby(['permno'])['saleq'].shift(4),1,0,1,0,Sales from quarter t minus sales from quarter t-4 (saleq) divided by fiscal-quarter- end market capitalization (cshoq * prccq).
,rvar_capm,Residual variance - CAPM rolling 3m,Daily Stock residual variance of CAPM,,,,,,,,,
,rvar_ff3,Residual variance - ff3 rolling 3m,Daily Stock residual variance of Fama French 3 factors,,,,,,,,,
,rvar_mean,return variance rolling 3m,Daily Stock return variance,,,,,,,,,
,sgr,Sales growth,"Lakonishok, Shleifer & Vishny",1994,,data_rawq['sgr'] = (data_rawq['saleq4']/data_rawq['saleq4_l4'])-1,"data_rawq['saleq4'] = ttm4('saleq', data_rawq)
data_rawq['saleq4'] = np.where(data_rawq['saleq4'].isnull(), data_rawq['saley'], data_rawq['saleq4'])

data_rawq['saleq4_l4'] = data_rawq.groupby(['permno'])['saleq4'].shift(4)",1,0,1,0,Annual percent change in sales (sale).
,std_dolvol,Std of dollar trading volume rolling 3m,"Chordia, Subrahmanyam & Anshuman",2001,,,,,,,,Monthly standard deviation of daily dollar trading volume.
,std_turn,Std. of Share turnover rolling 3m,"Chordia, Subrahmanyam, &Anshuman",2001,,,,,,,,Monthly standard deviation of daily share turnover.
,sue,Unexpected quarterly earnings,"Rendelman, Jones & Latane",1982,,,,,,,,"Unexpected quarterly earnings divided by fiscal-quarter-end market cap. Unexpected earnings is I/B/E/S actual earnings minus median forecasted earnings if available, else it is the seasonally differenced quarterly earnings before extraordinary items from Compustat quarterly file."
,turn,Shares turnover,"Datar, Naik & Radcliffe",1998,,,,,,,,Average monthly trading volume for most recent 3 months scaled by number of shares outstanding in current month.
,zerotrade,Number of zero-trading days rolling 3m,Liu,2006,,,,,,,,Turnover weighted number of zero trading days for most recent 1 month.
